import{Aa as qo,Ba as jo,Ca as Ho,D as bn,Da as Vo,Ea as Go,F as go,Fa as zo,G as Hs,Ga as Ko,Ha as Qo,I as kt,K as mo,L as yo,Q as Pt,R as At,S as vo,W as wo,a as Cn,b as co,c as Rt,ca as Co,d as St,e as Ce,fa as Eo,g as $s,ga as To,h as uo,ha as Je,i as ho,ia as Mo,j as qs,ja as Lo,k as fo,ka as Ot,l as _o,la as Mt,m as Nt,ma as Ks,n as po,na as fe,oa as Fo,pa as Uo,q as En,r as re,ra as Qs,s as ue,sa as Bo,t as I,u as js,ua as xn,va as Dn,w as Tn,wa as On,x as oe,xa as Wo,ya as Mn,za as $o}from"./chunk-RT7UHDO4.js";import{A as M,B as ko,C as Po,D as te,E as be,F as Sn,G as xt,I as Ao,J as xo,K as g,L as Q,M as U,N as Gs,O as Do,P as Dt,Q as A,R as de,S as Nn,T as zs,U as Oo,V as kn,W as Pn,X as An,Z as Ie,_ as Re,a as ao,b as lo,f as Fe,k as _,l as Xe,m as bo,n as Io,o as Ro,p as H,q as In,s as Vs,t as So,u as he,x as No,z as Rn}from"./chunk-JKUAMYJU.js";var Ln=class{constructor(e){return e}},Yo="firestore",Ys=class{constructor(){return Lo(Yo)}};var Xo=new ue("angularfire2.firestore-instances");function du(t,e){let n=Mo(Yo,t,e);return n&&new Ln(n)}var fu={provide:Ys,deps:[[new js,Xo]]},_u={provide:Ln,useFactory:du,deps:[[new js,Xo],Fo]},Jo=(()=>{class t{constructor(){Ie("angularfire",Je.full,"fst")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=oe({type:t});static \u0275inj=re({providers:[_u,fu]})}return t})();var Zo=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Tn({type:e,selectors:[["app-error-page"]],decls:2,vars:0,template:function(i,r){i&1&&(Pt(0,"p"),wo(1,"error-page works!"),At())}});let t=e;return t})();var pu=[{path:"",loadChildren:()=>import("./chunk-X7UO442M.js").then(t=>t.MercarfrutModule)},{path:"**",component:Zo}],ea=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=oe({type:e}),e.\u0275inj=re({imports:[Qs.forRoot(pu),Qs]});let t=e;return t})();function gu(t,e){t&1&&(Pt(0,"div",1),vo(1,"div",2),At())}var ta=(()=>{let e=class e{constructor(s){this.loaderService=s,this.title="mercarfrut",this.showLoader=!0}ngOnInit(){this.loaderService.status.subscribe(s=>{this.showLoader=s})}};e.\u0275fac=function(i){return new(i||e)(Hs(Bo))},e.\u0275cmp=Tn({type:e,selectors:[["app-root"]],decls:2,vars:1,consts:[["id","preloder",4,"ngIf"],["id","preloder"],[1,"loader"]],template:function(i,r){i&1&&(Pt(0,"router-outlet"),mo(1,gu,2,0,"div",0),At()),i&2&&(go(),yo("ngIf",r.showLoader))},dependencies:[Co,Uo]});let t=e;return t})();var na="@firebase/database",sa="1.0.4";var lr="";function cr(t){lr=t}var ii=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),M(n))}get(e){let n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Rn(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var ri=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return te(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Oa=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){let e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ii(e)}}catch{}return new ri},Be=Oa("localStorage"),oi=Oa("sessionStorage");var st=new kn("@firebase/database"),Ma=function(){let t=1;return function(){return t++}}(),La=function(t){let e=Do(t),n=new xo;n.update(e);let s=n.digest();return bo.encodeByteArray(s)},on=function(...t){let e="";for(let n=0;n<t.length;n++){let s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=on.apply(null,s):typeof s=="object"?e+=M(s):e+=s,e+=" "}return e},We=null,ia=!0,Fa=function(t,e){_(!e||t===!0||t===!1,"Can't turn on custom loggers persistently."),t===!0?(st.logLevel=Oo.VERBOSE,We=st.log.bind(st),e&&oi.set("logging_enabled",!0)):typeof t=="function"?We=t:(We=null,oi.remove("logging_enabled"))},B=function(...t){if(ia===!0&&(ia=!1,We===null&&oi.get("logging_enabled")===!0&&Fa(!0)),We){let e=on.apply(null,t);We(e)}},an=function(t){return function(...e){B(t,...e)}},ai=function(...t){let e="FIREBASE INTERNAL ERROR: "+on(...t);st.error(e)},ge=function(...t){let e=`FIREBASE FATAL ERROR: ${on(...t)}`;throw st.error(e),new Error(e)},q=function(...t){let e="FIREBASE WARNING: "+on(...t);st.warn(e)},wu=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&q("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},us=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Cu=function(t){if(he()||document.readyState==="complete")t();else{let e=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Pe="[MIN_NAME]",Ee="[MAX_NAME]",qe=function(t,e){if(t===e)return 0;if(t===Pe||e===Ee)return-1;if(e===Pe||t===Ee)return 1;{let n=ra(t),s=ra(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},Eu=function(t,e){return t===e?0:t<e?-1:1},Lt=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+M(e))},ur=function(t){if(typeof t!="object"||t===null)return M(t);let e=[];for(let s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=M(e[s]),n+=":",n+=ur(t[e[s]]);return n+="}",n},Ua=function(t,e){let n=t.length;if(n<=e)return[t];let s=[];for(let i=0;i<n;i+=e)i+e>n?s.push(t.substring(i,n)):s.push(t.substring(i,i+e));return s};function W(t,e){for(let n in t)t.hasOwnProperty(n)&&e(n,t[n])}var Ba=function(t){_(!us(t),"Invalid JSON number");let e=11,n=52,s=(1<<e-1)-1,i,r,o,a,l;t===0?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),s),r=a+s,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-s-n))));let c=[];for(l=n;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(i?1:0),c.reverse();let u=c.join(""),h="";for(l=0;l<64;l+=8){let d=parseInt(u.substr(l,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},Tu=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},bu=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Iu(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");let s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}var Ru=new RegExp("^-?(0*)\\d{1,10}$"),Su=-2147483648,Nu=2147483647,ra=function(t){if(Ru.test(t)){let e=Number(t);if(e>=Su&&e<=Nu)return e}return null},dt=function(t){try{t()}catch(e){setTimeout(()=>{let n=e.stack||"";throw q("Exception was thrown by user callback.",n),e},Math.floor(0))}},ku=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Wt=function(t,e){let n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};var li=class{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){q(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var ci=class{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(B("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',q(e)}},$t=(()=>{class t{constructor(n){this.accessToken=n}getToken(n){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(n){n(this.accessToken)}removeTokenChangeListener(n){}notifyForInvalidToken(){}}t.OWNER="owner";return t})(),Un="5",Wa="v",$a="s",qa="r",ja="f",Ha=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Va="ls",Ga="p",ui="ac",za="websocket",Ka="long_polling";var Bn=class{constructor(e,n,s,i,r=!1,o="",a=!1,l=!1){this.secure=n,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Be.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Be.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}};function Pu(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Qa(t,e,n){_(typeof e=="string","typeof type must == string"),_(typeof n=="object","typeof params must == object");let s;if(e===za)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Ka)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Pu(t)&&(n.ns=t.namespace);let i=[];return W(n,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}var hi=class{constructor(){this.counters_={}}incrementCounter(e,n=1){te(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Ro(this.counters_)}};var Xs={},Js={};function hr(t){let e=t.toString();return Xs[e]||(Xs[e]=new hi),Xs[e]}function Au(t,e){let n=t.toString();return Js[n]||(Js[n]=e()),Js[n]}var di=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){let s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&dt(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var oa="start",xu="close",Du="pLPCommand",Ou="pRTLPCB",Ya="id",Xa="pw",Ja="ser",Mu="cb",Lu="seg",Fu="ts",Uu="d",Bu="dframe",Za=1870,el=30,Wu=Za-el,$u=25e3,qu=3e4,Vt=class t{constructor(e,n,s,i,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=an(e),this.stats_=hr(n),this.urlFn=l=>(this.appCheckToken&&(l[ui]=this.appCheckToken),Qa(n,Ka,l))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new di(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(qu)),Cu(()=>{if(this.isClosed_)return;this.scriptTagHolder=new fi((...r)=>{let[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===oa)this.id=a,this.password=l;else if(o===xu)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let s={};s[oa]="t",s[Ja]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Mu]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Wa]=Un,this.transportSessionId&&(s[$a]=this.transportSessionId),this.lastSessionId&&(s[Va]=this.lastSessionId),this.applicationId&&(s[Ga]=this.applicationId),this.appCheckToken&&(s[ui]=this.appCheckToken),typeof location<"u"&&location.hostname&&Ha.test(location.hostname)&&(s[qa]=ja);let i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){t.forceAllow_=!0}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){return he()?!1:t.forceAllow_?!0:!t.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Tu()&&!bu()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let n=M(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);let s=Io(n),i=Ua(s,Wu);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){if(he())return;this.myDisconnFrame=document.createElement("iframe");let s={};s[Bu]="t",s[Ya]=e,s[Xa]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let n=M(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}},fi=class t{constructor(e,n,s,i){if(this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,he())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=Ma(),window[Du+this.uniqueCallbackIdentifier]=e,window[Ou+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){B("frame writing exception"),a.stack&&B(a.stack),B(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||B("No IE domain setting required")}catch{let s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Ya]=this.myID,e[Xa]=this.myPW,e[Ja]=this.currentSerial;let n=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+el+s.length<=Za;){let o=this.pendingSegs.shift();s=s+"&"+Lu+i+"="+o.seg+"&"+Fu+i+"="+o.ts+"&"+Uu+i+"="+o.d,i++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);let s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(s,Math.floor($u)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,n){he()?this.doNodeLongPoll(e,n):setTimeout(()=>{try{if(!this.sendNewPolls)return;let s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){let i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{B("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}};var ju=16384,Hu=45e3,Wn=null;typeof MozWebSocket<"u"?Wn=MozWebSocket:typeof WebSocket<"u"&&(Wn=WebSocket);var tt=(()=>{class t{constructor(n,s,i,r,o,a,l){this.connId=n,this.applicationId=i,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=an(this.connId),this.stats_=hr(s),this.connURL=t.connectionURL_(s,a,l,r,i),this.nodeAdmin=s.nodeAdmin}static connectionURL_(n,s,i,r,o){let a={};return a[Wa]=Un,!he()&&typeof location<"u"&&location.hostname&&Ha.test(location.hostname)&&(a[qa]=ja),s&&(a[$a]=s),i&&(a[Va]=i),r&&(a[ui]=r),o&&(a[Ga]=o),Qa(n,za,a)}open(n,s){this.onDisconnect=s,this.onMessage=n,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Be.set("previous_websocket_failure",!0);try{let i;if(he()){let r=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${Un}/${lr}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new Wn(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let r=i.message||i.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){t.forceDisallow_=!0}static isAvailable(){let n=!1;if(typeof navigator<"u"&&navigator.userAgent){let s=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(s);i&&i.length>1&&parseFloat(i[1])<4.4&&(n=!0)}return!n&&Wn!==null&&!t.forceDisallow_}static previouslyFailed(){return Be.isInMemoryStorage||Be.get("previous_websocket_failure")===!0}markConnectionHealthy(){Be.remove("previous_websocket_failure")}appendFrame_(n){if(this.frames.push(n),this.frames.length===this.totalFrames){let s=this.frames.join("");this.frames=null;let i=Rn(s);this.onMessage(i)}}handleNewFrameCount_(n){this.totalFrames=n,this.frames=[]}extractFrameCount_(n){if(_(this.frames===null,"We already have a frame buffer"),n.length<=6){let s=Number(n);if(!isNaN(s))return this.handleNewFrameCount_(s),null}return this.handleNewFrameCount_(1),n}handleIncomingFrame(n){if(this.mySock===null)return;let s=n.data;if(this.bytesReceived+=s.length,this.stats_.incrementCounter("bytes_received",s.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(s);else{let i=this.extractFrameCount_(s);i!==null&&this.appendFrame_(i)}}send(n){this.resetKeepAlive();let s=M(n);this.bytesSent+=s.length,this.stats_.incrementCounter("bytes_sent",s.length);let i=Ua(s,ju);i.length>1&&this.sendString_(String(i.length));for(let r=0;r<i.length;r++)this.sendString_(i[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Hu))}sendString_(n){try{this.mySock.send(n)}catch(s){this.log_("Exception thrown from WebSocket.send():",s.message||s.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4;return t})(),tl=(()=>{class t{constructor(n){this.initTransports_(n)}static get ALL_TRANSPORTS(){return[Vt,tt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(n){let s=tt&&tt.isAvailable(),i=s&&!tt.previouslyFailed();if(n.webSocketOnly&&(s||q("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[tt];else{let r=this.transports_=[];for(let o of t.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);t.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}t.globalTransportInitialized_=!1;return t})(),Vu=6e4,Gu=5e3,zu=10*1024,Ku=100*1024,Zs="t",aa="d",Qu="s",la="r",Yu="e",ca="o",ua="a",ha="n",da="p",Xu="h",_i=class{constructor(e,n,s,i,r,o,a,l,c,u){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=an("c:"+this.id+":"),this.transportManager_=new tl(n),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Wt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Ku?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>zu?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){let n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Zs in e){let n=e[Zs];n===ua?this.upgradeIfSecondaryHealthy_():n===la?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===ca&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let n=Lt("t",e),s=Lt("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:da,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ua,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:ha,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let n=Lt("t",e),s=Lt("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let n=Lt(Zs,e);if(aa in e){let s=e[aa];if(n===Xu){let i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===ha){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Qu?this.onConnectionShutdown_(s):n===la?this.onReset_(s):n===Yu?ai("Server Error: "+s):n===ca?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ai("Unknown control packet command: "+n)}}onHandshake_(e){let n=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Un!==s&&q("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),Wt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Vu))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Wt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Gu))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:da,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Be.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var $n=class{put(e,n,s,i){}merge(e,n,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}};var qn=class{constructor(e){this.allowedEvents_=e,this.listeners_={},_(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){let s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});let i=this.getInitialEvent(e);i&&n.apply(s,i)}off(e,n,s){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===n&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){_(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}};var jn=class t extends qn{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Vs()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new t}getInitialEvent(e){return _(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var fa=32,_a=768,b=class{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}};function T(){return new b("")}function w(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ae(t){return t.pieces_.length-t.pieceNum_}function R(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new b(t.pieces_,e)}function dr(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Ju(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Gt(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function nl(t){if(t.pieceNum_>=t.pieces_.length)return null;let e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new b(e,0)}function N(t,e){let n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof b)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{let s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&n.push(s[i])}return new b(n,0)}function C(t){return t.pieceNum_>=t.pieces_.length}function V(t,e){let n=w(t),s=w(e);if(n===null)return e;if(n===s)return V(R(t),R(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Zu(t,e){let n=Gt(t,0),s=Gt(e,0);for(let i=0;i<n.length&&i<s.length;i++){let r=qe(n[i],s[i]);if(r!==0)return r}return n.length===s.length?0:n.length<s.length?-1:1}function fr(t,e){if(Ae(t)!==Ae(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function ne(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(Ae(t)>Ae(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}var pi=class{constructor(e,n){this.errorPrefix_=n,this.parts_=Gt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Dt(this.parts_[s]);sl(this)}};function eh(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Dt(e),sl(t)}function th(t){let e=t.parts_.pop();t.byteLength_-=Dt(e),t.parts_.length>0&&(t.byteLength_-=1)}function sl(t){if(t.byteLength_>_a)throw new Error(t.errorPrefix_+"has a key path longer than "+_a+" bytes ("+t.byteLength_+").");if(t.parts_.length>fa)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+fa+") or object contains a cycle "+Ue(t))}function Ue(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}var gi=class t extends qn{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{let s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new t}getInitialEvent(e){return _(e==="visible","Unknown event type: "+e),[this.visible_]}};var Ft=1e3,nh=60*5*1e3,pa=30*1e3,sh=1.3,ih=3e4,rh="server_kill",ga=3,_r=(()=>{class t extends $n{constructor(n,s,i,r,o,a,l,c){if(super(),this.repoInfo_=n,this.applicationId_=s,this.onDataUpdate_=i,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=t.nextPersistentConnectionId_++,this.log_=an("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ft,this.maxReconnectDelay_=nh,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!he())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");gi.getInstance().on("visible",this.onVisible_,this),n.host.indexOf("fblocal")===-1&&jn.getInstance().on("online",this.onOnline_,this)}sendRequest(n,s,i){let r=++this.requestNumber_,o={r,a:n,b:s};this.log_(M(o)),_(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[r]=i)}get(n){this.initConnection_();let s=new H,r={action:"g",request:{p:n._path.toString(),q:n._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?s.resolve(l):s.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),s.promise}listen(n,s,i,r){this.initConnection_();let o=n._queryIdentifier,a=n._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),_(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:s,query:n,tag:i};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(n){let s=this.outstandingGets_[n];this.sendRequest("g",s.request,i=>{delete this.outstandingGets_[n],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),s.onComplete&&s.onComplete(i)})}sendListen_(n){let s=n.query,i=s._path.toString(),r=s._queryIdentifier;this.log_("Listen on "+i+" for "+r);let o={p:i},a="q";n.tag&&(o.q=s._queryObject,o.t=n.tag),o.h=n.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;t.warnOnListenWarnings_(c,s),(this.listens.get(i)&&this.listens.get(i).get(r))===n&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(i,r),n.onComplete&&n.onComplete(u,c))})}static warnOnListenWarnings_(n,s){if(n&&typeof n=="object"&&te(n,"w")){let i=be(n,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let r='".indexOn": "'+s._queryParams.getIndex().toString()+'"',o=s._path.toString();q(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(n){this.authToken_=n,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(n)}reduceReconnectDelayIfAdminCredential_(n){(n&&n.length===40||Po(n))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=pa)}refreshAppCheckToken(n){this.appCheckToken_=n,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let n=this.authToken_,s=ko(n)?"auth":"gauth",i={cred:n};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(s,i,r=>{let o=r.s,a=r.d||"error";this.authToken_===n&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},n=>{let s=n.s,i=n.d||"error";s==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(s,i)})}unlisten(n,s){let i=n._path.toString(),r=n._queryIdentifier;this.log_("Unlisten called for "+i+" "+r),_(n._queryParams.isDefault()||!n._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,r)&&this.connected_&&this.sendUnlisten_(i,r,n._queryObject,s)}sendUnlisten_(n,s,i,r){this.log_("Unlisten on "+n+" for "+s);let o={p:n},a="n";r&&(o.q=i,o.t=r),this.sendRequest(a,o)}onDisconnectPut(n,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",n,s,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"o",data:s,onComplete:i})}onDisconnectMerge(n,s,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",n,s,i):this.onDisconnectRequestQueue_.push({pathString:n,action:"om",data:s,onComplete:i})}onDisconnectCancel(n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",n,null,s):this.onDisconnectRequestQueue_.push({pathString:n,action:"oc",data:null,onComplete:s})}sendOnDisconnect_(n,s,i,r){let o={p:s,d:i};this.log_("onDisconnect "+n,o),this.sendRequest(n,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(n,s,i,r){this.putInternal("p",n,s,i,r)}merge(n,s,i,r){this.putInternal("m",n,s,i,r)}putInternal(n,s,i,r,o){this.initConnection_();let a={p:s,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:n,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+s)}sendPut_(n){let s=this.outstandingPuts_[n].action,i=this.outstandingPuts_[n].request,r=this.outstandingPuts_[n].onComplete;this.outstandingPuts_[n].queued=this.connected_,this.sendRequest(s,i,o=>{this.log_(s+" response",o),delete this.outstandingPuts_[n],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(n){if(this.connected_){let s={c:n};this.log_("reportStats",s),this.sendRequest("s",s,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(n){if("r"in n){this.log_("from server: "+M(n));let s=n.r,i=this.requestCBHash_[s];i&&(delete this.requestCBHash_[s],i(n.b))}else{if("error"in n)throw"A server-side error has occurred: "+n.error;"a"in n&&this.onDataPush_(n.a,n.b)}}onDataPush_(n,s){this.log_("handleServerMessage",n,s),n==="d"?this.onDataUpdate_(s.p,s.d,!1,s.t):n==="m"?this.onDataUpdate_(s.p,s.d,!0,s.t):n==="c"?this.onListenRevoked_(s.p,s.q):n==="ac"?this.onAuthRevoked_(s.s,s.d):n==="apc"?this.onAppCheckRevoked_(s.s,s.d):n==="sd"?this.onSecurityDebugPacket_(s):ai("Unrecognized action received from server: "+M(n)+`
Are you using the latest client?`)}onReady_(n,s){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(n),this.lastSessionId=s,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(n){_(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(n))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(n){n&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ft,this.realtime_||this.scheduleConnect_(0)),this.visible_=n}onOnline_(n){n?(this.log_("Browser went online."),this.reconnectDelay_=Ft,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>ih&&(this.reconnectDelay_=Ft),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let n=new Date().getTime()-this.lastConnectionAttemptTime_,s=Math.max(0,this.reconnectDelay_-n);s=Math.random()*s,this.log_("Trying to reconnect in "+s+"ms"),this.scheduleConnect_(s),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*sh)}this.onConnectStatus_(!1)}establishConnection_(){return Fe(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let n=this.onDataMessage_.bind(this),s=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+t.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,i())},u=function(d){_(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(d)};this.realtime_={close:c,sendRequest:u};let h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[d,f]=yield Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);a?B("getToken() completed but was canceled"):(B("getToken() completed. Creating connection."),this.authToken_=d&&d.accessToken,this.appCheckToken_=f&&f.token,l=new _i(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,n,s,i,p=>{q(p+" ("+this.repoInfo_.toString()+")"),this.interrupt(rh)},o))}catch(d){this.log_("Failed to get token: "+d),a||(this.repoInfo_.nodeAdmin&&q(d),c())}}})}interrupt(n){B("Interrupting connection for reason: "+n),this.interruptReasons_[n]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(n){B("Resuming connection for reason: "+n),delete this.interruptReasons_[n],Sn(this.interruptReasons_)&&(this.reconnectDelay_=Ft,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(n){let s=n-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:s})}cancelSentTransactions_(){for(let n=0;n<this.outstandingPuts_.length;n++){let s=this.outstandingPuts_[n];s&&"h"in s.request&&s.queued&&(s.onComplete&&s.onComplete("disconnect"),delete this.outstandingPuts_[n],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(n,s){let i;s?i=s.map(o=>ur(o)).join("$"):i="default";let r=this.removeListen_(n,i);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(n,s){let i=new b(n).toString(),r;if(this.listens.has(i)){let o=this.listens.get(i);r=o.get(s),o.delete(s),o.size===0&&this.listens.delete(i)}else r=void 0;return r}onAuthRevoked_(n,s){B("Auth token revoked: "+n+"/"+s),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(n==="invalid_token"||n==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ga&&(this.reconnectDelay_=pa,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(n,s){B("App check token revoked: "+n+"/"+s),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(n==="invalid_token"||n==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ga&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(n){this.securityDebugCallback_?this.securityDebugCallback_(n):"msg"in n&&console.log("FIREBASE: "+n.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let n of this.listens.values())for(let s of n.values())this.sendListen_(s);for(let n=0;n<this.outstandingPuts_.length;n++)this.outstandingPuts_[n]&&this.sendPut_(n);for(;this.onDisconnectRequestQueue_.length;){let n=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(n.action,n.pathString,n.data,n.onComplete)}for(let n=0;n<this.outstandingGets_.length;n++)this.outstandingGets_[n]&&this.sendGet_(n)}sendConnectStats_(){let n={},s="js";he()&&(this.repoInfo_.nodeAdmin?s="admin_node":s="node"),n["sdk."+s+"."+lr.replace(/\./g,"-")]=1,Vs()?n["framework.cordova"]=1:So()&&(n["framework.reactnative"]=1),this.reportStats(n)}shouldReconnect_(){let n=jn.getInstance().currentlyOnline();return Sn(this.interruptReasons_)&&n}}t.nextPersistentConnectionId_=0,t.nextConnectionId_=0;return t})(),E=class t{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new t(e,n)}};var it=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){let s=new E(Pe,e),i=new E(Pe,n);return this.compare(s,i)!==0}minPost(){return E.MIN}};var Fn,Hn=class extends it{static get __EMPTY_NODE(){return Fn}static set __EMPTY_NODE(e){Fn=e}compare(e,n){return qe(e.name,n.name)}isDefinedOn(e){throw Xe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return E.MIN}maxPost(){return new E(Ee,Fn)}makePost(e,n){return _(typeof e=="string","KeyIndex indexValue must always be a string."),new E(e,Fn)}toString(){return".key"}},pe=new Hn;var nt=class{constructor(e,n,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},ae=(()=>{class t{constructor(n,s,i,r,o){this.key=n,this.value=s,this.color=i??t.RED,this.left=r??se.EMPTY_NODE,this.right=o??se.EMPTY_NODE}copy(n,s,i,r,o){return new t(n??this.key,s??this.value,i??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||!!n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,s,i){let r=this,o=i(n,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(n,s,i),null):o===0?r=r.copy(null,s,null,null,null):r=r.copy(null,null,null,null,r.right.insert(n,s,i)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return se.EMPTY_NODE;let n=this;return!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.removeMin_(),null),n.fixUp_()}remove(n,s){let i,r;if(i=this,s(n,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(n,s),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),s(n,i.key)===0){if(i.right.isEmpty())return se.EMPTY_NODE;r=i.right.min_(),i=i.copy(r.key,r.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(n,s))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let n=this;return n.right.isRed_()&&!n.left.isRed_()&&(n=n.rotateLeft_()),n.left.isRed_()&&n.left.left.isRed_()&&(n=n.rotateRight_()),n.left.isRed_()&&n.right.isRed_()&&(n=n.colorFlip_()),n}moveRedLeft_(){let n=this.colorFlip_();return n.right.left.isRed_()&&(n=n.copy(null,null,null,null,n.right.rotateRight_()),n=n.rotateLeft_(),n=n.colorFlip_()),n}moveRedRight_(){let n=this.colorFlip_();return n.left.left.isRed_()&&(n=n.rotateRight_(),n=n.colorFlip_()),n}rotateLeft_(){let n=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight_(){let n=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip_(){let n=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,s)}checkMaxDepth_(){let n=this.check_();return Math.pow(2,n)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let n=this.left.check_();if(n!==this.right.check_())throw new Error("Black depths differ");return n+(this.isRed_()?0:1)}}return t.RED=!0,t.BLACK=!1,t})(),mi=class{copy(e,n,s,i,r){return this}insert(e,n,s){return new ae(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},se=class t{constructor(e,n=t.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,ae.BLACK,null,null))}remove(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ae.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,i=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new nt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new nt(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new nt(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new nt(this.root_,null,this.comparator_,!0,e)}};se.EMPTY_NODE=new mi;function oh(t,e){return qe(t.name,e.name)}function pr(t,e){return qe(t,e)}var yi;function ah(t){yi=t}var il=function(t){return typeof t=="number"?"number:"+Ba(t):"string:"+t},rl=function(t){if(t.isLeafNode()){let e=t.val();_(typeof e=="string"||typeof e=="number"||typeof e=="object"&&te(e,".sv"),"Priority must be a string or number.")}else _(t===yi||t.isEmpty(),"priority of unexpected type.");_(t===yi||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var ma,rt=(()=>{class t{constructor(n,s=t.__childrenNodeConstructor.EMPTY_NODE){this.value_=n,this.priorityNode_=s,this.lazyHash_=null,_(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),rl(this.priorityNode_)}static set __childrenNodeConstructor(n){ma=n}static get __childrenNodeConstructor(){return ma}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(n){return new t(this.value_,n)}getImmediateChild(n){return n===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}getChild(n){return C(n)?this:w(n)===".priority"?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(n,s){return null}updateImmediateChild(n,s){return n===".priority"?this.updatePriority(s):s.isEmpty()&&n!==".priority"?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(n,s).updatePriority(this.priorityNode_)}updateChild(n,s){let i=w(n);return i===null?s:s.isEmpty()&&i!==".priority"?this:(_(i!==".priority"||Ae(n)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(R(n),s)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(n,s){return!1}val(n){return n&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let n="";this.priorityNode_.isEmpty()||(n+="priority:"+il(this.priorityNode_.val())+":");let s=typeof this.value_;n+=s+":",s==="number"?n+=Ba(this.value_):n+=this.value_,this.lazyHash_=La(n)}return this.lazyHash_}getValue(){return this.value_}compareTo(n){return n===t.__childrenNodeConstructor.EMPTY_NODE?1:n instanceof t.__childrenNodeConstructor?-1:(_(n.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(n))}compareToLeafNode_(n){let s=typeof n.value_,i=typeof this.value_,r=t.VALUE_TYPE_ORDER.indexOf(s),o=t.VALUE_TYPE_ORDER.indexOf(i);return _(r>=0,"Unknown leaf type: "+s),_(o>=0,"Unknown leaf type: "+i),r===o?i==="object"?0:this.value_<n.value_?-1:this.value_===n.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(n){if(n===this)return!0;if(n.isLeafNode()){let s=n;return this.value_===s.value_&&this.priorityNode_.equals(s.priorityNode_)}else return!1}}t.VALUE_TYPE_ORDER=["object","boolean","number","string"];return t})(),ol,al;function lh(t){ol=t}function ch(t){al=t}var vi=class extends it{compare(e,n){let s=e.node.getPriority(),i=n.node.getPriority(),r=s.compareTo(i);return r===0?qe(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return E.MIN}maxPost(){return new E(Ee,new rt("[PRIORITY-POST]",al))}makePost(e,n){let s=ol(e);return new E(n,new rt("[PRIORITY-POST]",s))}toString(){return".priority"}},S=new vi;var uh=Math.log(2),wi=class{constructor(e){let n=r=>parseInt(Math.log(r)/uh,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;let i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Vn=function(t,e,n,s){t.sort(e);let i=function(l,c){let u=c-l,h,d;if(u===0)return null;if(u===1)return h=t[l],d=n?n(h):h,new ae(d,h.node,ae.BLACK,null,null);{let f=parseInt(u/2,10)+l,p=i(l,f),m=i(f+1,c);return h=t[f],d=n?n(h):h,new ae(d,h.node,ae.BLACK,p,m)}},r=function(l){let c=null,u=null,h=t.length,d=function(p,m){let v=h-p,O=h;h-=p;let L=i(v+1,O),P=t[v],F=n?n(P):P;f(new ae(F,P.node,m,null,L))},f=function(p){c?(c.left=p,c=p):(u=p,c=p)};for(let p=0;p<l.count;++p){let m=l.nextBitIsOne(),v=Math.pow(2,l.count-(p+1));m?d(v,ae.BLACK):(d(v,ae.BLACK),d(v,ae.RED))}return u},o=new wi(t.length),a=r(o);return new se(s||e,a)};var ei,et={},ot=class t{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return _(et&&S,"ChildrenNode.ts has not been loaded"),ei=ei||new t({".priority":et},{".priority":S}),ei}get(e){let n=be(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof se?n:null}hasIndex(e){return te(this.indexSet_,e.toString())}addIndex(e,n){_(e!==pe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let s=[],i=!1,r=n.getIterator(E.Wrap),o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=Vn(s,e.getCompare()):a=et;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new t(u,c)}addToIndexes(e,n){let s=xt(this.indexes_,(i,r)=>{let o=be(this.indexSet_,r);if(_(o,"Missing index implementation for "+r),i===et)if(o.isDefinedOn(e.node)){let a=[],l=n.getIterator(E.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Vn(a,o.getCompare())}else return et;else{let a=n.get(e.name),l=i;return a&&(l=l.remove(new E(e.name,a))),l.insert(e,e.node)}});return new t(s,this.indexSet_)}removeFromIndexes(e,n){let s=xt(this.indexes_,i=>{if(i===et)return i;{let r=n.get(e.name);return r?i.remove(new E(e.name,r)):i}});return new t(s,this.indexSet_)}};var Ut,y=(()=>{class t{constructor(n,s,i){this.children_=n,this.priorityNode_=s,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&rl(this.priorityNode_),this.children_.isEmpty()&&_(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ut||(Ut=new t(new se(pr),null,ot.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ut}updatePriority(n){return this.children_.isEmpty()?this:new t(this.children_,n,this.indexMap_)}getImmediateChild(n){if(n===".priority")return this.getPriority();{let s=this.children_.get(n);return s===null?Ut:s}}getChild(n){let s=w(n);return s===null?this:this.getImmediateChild(s).getChild(R(n))}hasChild(n){return this.children_.get(n)!==null}updateImmediateChild(n,s){if(_(s,"We should always be passing snapshot nodes"),n===".priority")return this.updatePriority(s);{let i=new E(n,s),r,o;s.isEmpty()?(r=this.children_.remove(n),o=this.indexMap_.removeFromIndexes(i,this.children_)):(r=this.children_.insert(n,s),o=this.indexMap_.addToIndexes(i,this.children_));let a=r.isEmpty()?Ut:this.priorityNode_;return new t(r,a,o)}}updateChild(n,s){let i=w(n);if(i===null)return s;{_(w(n)!==".priority"||Ae(n)===1,".priority must be the last token in a path");let r=this.getImmediateChild(i).updateChild(R(n),s);return this.updateImmediateChild(i,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(n){if(this.isEmpty())return null;let s={},i=0,r=0,o=!0;if(this.forEachChild(S,(a,l)=>{s[a]=l.val(n),i++,o&&t.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!n&&o&&r<2*i){let a=[];for(let l in s)a[l]=s[l];return a}else return n&&!this.getPriority().isEmpty()&&(s[".priority"]=this.getPriority().val()),s}hash(){if(this.lazyHash_===null){let n="";this.getPriority().isEmpty()||(n+="priority:"+il(this.getPriority().val())+":"),this.forEachChild(S,(s,i)=>{let r=i.hash();r!==""&&(n+=":"+s+":"+r)}),this.lazyHash_=n===""?"":La(n)}return this.lazyHash_}getPredecessorChildName(n,s,i){let r=this.resolveIndex_(i);if(r){let o=r.getPredecessorKey(new E(n,s));return o?o.name:null}else return this.children_.getPredecessorKey(n)}getFirstChildName(n){let s=this.resolveIndex_(n);if(s){let i=s.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(n){let s=this.getFirstChildName(n);return s?new E(s,this.children_.get(s)):null}getLastChildName(n){let s=this.resolveIndex_(n);if(s){let i=s.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(n){let s=this.getLastChildName(n);return s?new E(s,this.children_.get(s)):null}forEachChild(n,s){let i=this.resolveIndex_(n);return i?i.inorderTraversal(r=>s(r.name,r.node)):this.children_.inorderTraversal(s)}getIterator(n){return this.getIteratorFrom(n.minPost(),n)}getIteratorFrom(n,s){let i=this.resolveIndex_(s);if(i)return i.getIteratorFrom(n,r=>r);{let r=this.children_.getIteratorFrom(n.name,E.Wrap),o=r.peek();for(;o!=null&&s.compare(o,n)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(n){return this.getReverseIteratorFrom(n.maxPost(),n)}getReverseIteratorFrom(n,s){let i=this.resolveIndex_(s);if(i)return i.getReverseIteratorFrom(n,r=>r);{let r=this.children_.getReverseIteratorFrom(n.name,E.Wrap),o=r.peek();for(;o!=null&&s.compare(o,n)>0;)r.getNext(),o=r.peek();return r}}compareTo(n){return this.isEmpty()?n.isEmpty()?0:-1:n.isLeafNode()||n.isEmpty()?1:n===ln?-1:0}withIndex(n){if(n===pe||this.indexMap_.hasIndex(n))return this;{let s=this.indexMap_.addIndex(n,this.children_);return new t(this.children_,this.priorityNode_,s)}}isIndexed(n){return n===pe||this.indexMap_.hasIndex(n)}equals(n){if(n===this)return!0;if(n.isLeafNode())return!1;{let s=n;if(this.getPriority().equals(s.getPriority()))if(this.children_.count()===s.children_.count()){let i=this.getIterator(S),r=s.getIterator(S),o=i.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(n){return n===pe?null:this.indexMap_.get(n.toString())}}return t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t})(),Ci=class extends y{constructor(){super(new se(pr),y.EMPTY_NODE,ot.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return y.EMPTY_NODE}isEmpty(){return!1}},ln=new Ci;Object.defineProperties(E,{MIN:{value:new E(Pe,y.EMPTY_NODE)},MAX:{value:new E(Ee,ln)}});Hn.__EMPTY_NODE=y.EMPTY_NODE;rt.__childrenNodeConstructor=y;ah(ln);ch(ln);var hh=!0;function x(t,e=null){if(t===null)return y.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),_(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){let n=t;return new rt(n,x(e))}if(!(t instanceof Array)&&hh){let n=[],s=!1;if(W(t,(o,a)=>{if(o.substring(0,1)!=="."){let l=x(a);l.isEmpty()||(s=s||!l.getPriority().isEmpty(),n.push(new E(o,l)))}}),n.length===0)return y.EMPTY_NODE;let r=Vn(n,oh,o=>o.name,pr);if(s){let o=Vn(n,S.getCompare());return new y(r,x(e),new ot({".priority":o},{".priority":S}))}else return new y(r,x(e),ot.Default)}else{let n=y.EMPTY_NODE;return W(t,(s,i)=>{if(te(t,s)&&s.substring(0,1)!=="."){let r=x(i);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(s,r))}}),n.updatePriority(x(e))}}lh(x);var zt=class extends it{constructor(e){super(),this.indexPath_=e,_(!C(e)&&w(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){let s=this.extractChild(e.node),i=this.extractChild(n.node),r=s.compareTo(i);return r===0?qe(e.name,n.name):r}makePost(e,n){let s=x(e),i=y.EMPTY_NODE.updateChild(this.indexPath_,s);return new E(n,i)}maxPost(){let e=y.EMPTY_NODE.updateChild(this.indexPath_,ln);return new E(Ee,e)}toString(){return Gt(this.indexPath_,0).join("/")}};var Ei=class extends it{compare(e,n){let s=e.node.compareTo(n.node);return s===0?qe(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(e,n){let s=x(e);return new E(n,s)}toString(){return".value"}},gr=new Ei;function ll(t){return{type:"value",snapshotNode:t}}function at(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function Kt(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Qt(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function dh(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}var Yt=class{constructor(e){this.index_=e}updateChild(e,n,s,i,r,o){_(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(n);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(Kt(n,a)):_(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(at(n,s)):o.trackChildChange(Qt(n,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(S,(i,r)=>{n.hasChild(i)||s.trackChildChange(Kt(i,r))}),n.isLeafNode()||n.forEachChild(S,(i,r)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Qt(i,r,o))}else s.trackChildChange(at(i,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?y.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var Gn=class t{constructor(e){this.indexedFilter_=new Yt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,i,r,o){return this.matches(new E(n,s))||(s=y.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,i,r,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=y.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(y.EMPTY_NODE);let r=this;return n.forEachChild(S,(o,a)=>{r.matches(new E(o,a))||(i=i.updateImmediateChild(o,y.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}};var Ti=class{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{let s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{let s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Gn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,i,r,o){return this.rangedFilter_.matches(new E(n,s))||(s=y.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,i,r,o):this.fullLimitUpdateChild_(e,n,s,r,o)}updateFullNode(e,n,s){let i;if(n.isLeafNode()||n.isEmpty())i=y.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=y.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(y.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,y.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,i,r){let o;if(this.reverse_){let h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();let a=e;_(a.numChildren()===this.limit_,"");let l=new E(n,s),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(n)){let h=a.getImmediateChild(n),d=i.getChildAfterChild(this.index_,c,this.reverse_);for(;d!=null&&(d.name===n||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);let f=d==null?1:o(d,l);if(u&&!s.isEmpty()&&f>=0)return r?.trackChildChange(Qt(n,s,h)),a.updateImmediateChild(n,s);{r?.trackChildChange(Kt(n,h));let m=a.updateImmediateChild(n,y.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(at(d.name,d.node)),m.updateImmediateChild(d.name,d.node)):m}}else return s.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(Kt(c.name,c.node)),r.trackChildChange(at(n,s))),a.updateImmediateChild(n,s).updateImmediateChild(c.name,y.EMPTY_NODE)):e}};var Xt=class t{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=S}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Pe}hasEnd(){return this.endSet_}getIndexEndValue(){return _(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ee}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===S}copy(){let e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function fh(t){return t.loadsAllData()?new Yt(t.getIndex()):t.hasLimit()?new Ti(t):new Gn(t)}function _h(t,e){let n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="l",n}function ph(t,e){let n=t.copy();return n.limitSet_=!0,n.limit_=e,n.viewFrom_="r",n}function bi(t,e,n){let s=t.copy();return s.startSet_=!0,e===void 0&&(e=null),s.indexStartValue_=e,n!=null?(s.startNameSet_=!0,s.indexStartName_=n):(s.startNameSet_=!1,s.indexStartName_=""),s}function gh(t,e,n){let s;return t.index_===pe||n?s=bi(t,e,n):s=bi(t,e,Ee),s.startAfterSet_=!0,s}function Ii(t,e,n){let s=t.copy();return s.endSet_=!0,e===void 0&&(e=null),s.indexEndValue_=e,n!==void 0?(s.endNameSet_=!0,s.indexEndName_=n):(s.endNameSet_=!1,s.indexEndName_=""),s}function mh(t,e,n){let s;return t.index_===pe||n?s=Ii(t,e,n):s=Ii(t,e,Pe),s.endBeforeSet_=!0,s}function hs(t,e){let n=t.copy();return n.index_=e,n}function ya(t){let e={};if(t.isDefault())return e;let n;if(t.index_===S?n="$priority":t.index_===gr?n="$value":t.index_===pe?n="$key":(_(t.index_ instanceof zt,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=M(n),t.startSet_){let s=t.startAfterSet_?"startAfter":"startAt";e[s]=M(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+M(t.indexStartName_))}if(t.endSet_){let s=t.endBeforeSet_?"endBefore":"endAt";e[s]=M(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+M(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function va(t){let e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==S&&(e.i=t.index_.toString()),e}var Ri=class t extends $n{constructor(e,n,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=an("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(_(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,s,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=t.getListenId_(e,s),a={};this.listens_[o]=a;let l=ya(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(r,h,!1,s),be(this.listens_,o)===a){let d;c?c===401?d="permission_denied":d="rest_error:"+c:d="ok",i(d,null)}})}unlisten(e,n){let s=t.getListenId_(e,n);delete this.listens_[s]}get(e){let n=ya(e._queryParams),s=e._path.toString(),i=new H;return this.restRequest_(s+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(n.auth=i.accessToken),r&&r.token&&(n.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Ao(n);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Rn(a.responseText)}catch{q("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,l)}else a.status!==401&&a.status!==404&&q("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}};var Si=class{constructor(){this.rootNode_=y.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}};function zn(){return{value:null,children:new Map}}function ft(t,e,n){if(C(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{let s=w(e);t.children.has(s)||t.children.set(s,zn());let i=t.children.get(s);e=R(e),ft(i,e,n)}}function Ni(t,e){if(C(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{let n=t.value;return t.value=null,n.forEachChild(S,(s,i)=>{ft(t,new b(s),i)}),Ni(t,e)}}else if(t.children.size>0){let n=w(e);return e=R(e),t.children.has(n)&&Ni(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function ki(t,e,n){t.value!==null?n(e,t.value):yh(t,(s,i)=>{let r=new b(e.toString()+"/"+s);ki(i,r,n)})}function yh(t,e){t.children.forEach((n,s)=>{e(s,n)})}var Pi=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),n=Object.assign({},e);return this.last_&&W(this.last_,(s,i)=>{n[s]=n[s]-i}),this.last_=e,n}};var wa=10*1e3,vh=30*1e3,wh=5*60*1e3,Ai=class{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Pi(e);let s=wa+(vh-wa)*Math.random();Wt(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){let e=this.statsListener_.get(),n={},s=!1;W(e,(i,r)=>{r>0&&te(this.statsToReport_,i)&&(n[i]=r,s=!0)}),s&&this.server_.reportStats(n),Wt(this.reportStats_.bind(this),Math.floor(Math.random()*2*wh))}};var _e=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}(_e||{});function mr(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function yr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function vr(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var xi=class t{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=_e.ACK_USER_WRITE,this.source=mr()}operationForChild(e){if(C(this.path)){if(this.affectedTree.value!=null)return _(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let n=this.affectedTree.subtree(new b(e));return new t(T(),n,this.revert)}}else return _(w(this.path)===e,"operationForChild called for unrelated child."),new t(R(this.path),this.affectedTree,this.revert)}};var Kn=class t{constructor(e,n){this.source=e,this.path=n,this.type=_e.LISTEN_COMPLETE}operationForChild(e){return C(this.path)?new t(this.source,T()):new t(this.source,R(this.path))}};var lt=class t{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=_e.OVERWRITE}operationForChild(e){return C(this.path)?new t(this.source,T(),this.snap.getImmediateChild(e)):new t(this.source,R(this.path),this.snap)}};var Jt=class t{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=_e.MERGE}operationForChild(e){if(C(this.path)){let n=this.children.subtree(new b(e));return n.isEmpty()?null:n.value?new lt(this.source,T(),n.value):new t(this.source,T(),n)}else return _(w(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,R(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var me=class{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(C(e))return this.isFullyInitialized()&&!this.filtered_;let n=w(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Di=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Ch(t,e,n,s){let i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(dh(o.childName,o.snapshotNode))}),Bt(t,i,"child_removed",e,s,n),Bt(t,i,"child_added",e,s,n),Bt(t,i,"child_moved",r,s,n),Bt(t,i,"child_changed",e,s,n),Bt(t,i,"value",e,s,n),i}function Bt(t,e,n,s,i,r){let o=s.filter(a=>a.type===n);o.sort((a,l)=>Th(t,a,l)),o.forEach(a=>{let l=Eh(t,a,r);i.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,t.query_))})})}function Eh(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function Th(t,e,n){if(e.childName==null||n.childName==null)throw Xe("Should only compare child_ events.");let s=new E(e.childName,e.snapshotNode),i=new E(n.childName,n.snapshotNode);return t.index_.compare(s,i)}function ds(t,e){return{eventCache:t,serverCache:e}}function qt(t,e,n,s){return ds(new me(e,n,s),t.serverCache)}function cl(t,e,n,s){return ds(t.eventCache,new me(e,n,s))}function Qn(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function $e(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var ti,bh=()=>(ti||(ti=new se(Eu)),ti),G=class t{constructor(e,n=bh()){this.value=e,this.children=n}static fromObject(e){let n=new t(null);return W(e,(s,i)=>{n=n.set(new b(s),i)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:T(),value:this.value};if(C(e))return null;{let s=w(e),i=this.children.get(s);if(i!==null){let r=i.findRootMostMatchingPathAndValue(R(e),n);return r!=null?{path:N(new b(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(C(e))return this;{let n=w(e),s=this.children.get(n);return s!==null?s.subtree(R(e)):new t(null)}}set(e,n){if(C(e))return new t(n,this.children);{let s=w(e),r=(this.children.get(s)||new t(null)).set(R(e),n),o=this.children.insert(s,r);return new t(this.value,o)}}remove(e){if(C(e))return this.children.isEmpty()?new t(null):new t(null,this.children);{let n=w(e),s=this.children.get(n);if(s){let i=s.remove(R(e)),r;return i.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,i),this.value===null&&r.isEmpty()?new t(null):new t(this.value,r)}else return this}}get(e){if(C(e))return this.value;{let n=w(e),s=this.children.get(n);return s?s.get(R(e)):null}}setTree(e,n){if(C(e))return n;{let s=w(e),r=(this.children.get(s)||new t(null)).setTree(R(e),n),o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new t(this.value,o)}}fold(e){return this.fold_(T(),e)}fold_(e,n){let s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(N(e,i),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,T(),n)}findOnPath_(e,n,s){let i=this.value?s(n,this.value):!1;if(i)return i;if(C(e))return null;{let r=w(e),o=this.children.get(r);return o?o.findOnPath_(R(e),N(n,r),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,T(),n)}foreachOnPath_(e,n,s){if(C(e))return this;{this.value&&s(n,this.value);let i=w(e),r=this.children.get(i);return r?r.foreachOnPath_(R(e),N(n,i),s):new t(null)}}foreach(e){this.foreach_(T(),e)}foreach_(e,n){this.children.inorderTraversal((s,i)=>{i.foreach_(N(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}};var le=class t{constructor(e){this.writeTree_=e}static empty(){return new t(new G(null))}};function jt(t,e,n){if(C(e))return new le(new G(n));{let s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){let i=s.path,r=s.value,o=V(i,e);return r=r.updateChild(o,n),new le(t.writeTree_.set(i,r))}else{let i=new G(n),r=t.writeTree_.setTree(e,i);return new le(r)}}}function Oi(t,e,n){let s=t;return W(n,(i,r)=>{s=jt(s,N(e,i),r)}),s}function Ca(t,e){if(C(e))return le.empty();{let n=t.writeTree_.setTree(e,new G(null));return new le(n)}}function Mi(t,e){return je(t,e)!=null}function je(t,e){let n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(V(n.path,e)):null}function Ea(t){let e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(S,(s,i)=>{e.push(new E(s,i))}):t.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new E(s,i.value))}),e}function Ne(t,e){if(C(e))return t;{let n=je(t,e);return n!=null?new le(new G(n)):new le(t.writeTree_.subtree(e))}}function Li(t){return t.writeTree_.isEmpty()}function ct(t,e){return ul(T(),t.writeTree_,e)}function ul(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(_(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):n=ul(N(t,i),r,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(N(t,".priority"),s)),n}}function fs(t,e){return _l(e,t)}function Ih(t,e,n,s,i){_(s>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:i}),i&&(t.visibleWrites=jt(t.visibleWrites,e,n)),t.lastWriteId=s}function Rh(t,e,n,s){_(s>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:s,visible:!0}),t.visibleWrites=Oi(t.visibleWrites,e,n),t.lastWriteId=s}function Sh(t,e){for(let n=0;n<t.allWrites.length;n++){let s=t.allWrites[n];if(s.writeId===e)return s}return null}function Nh(t,e){let n=t.allWrites.findIndex(a=>a.writeId===e);_(n>=0,"removeWrite called with nonexistent writeId.");let s=t.allWrites[n];t.allWrites.splice(n,1);let i=s.visible,r=!1,o=t.allWrites.length-1;for(;i&&o>=0;){let a=t.allWrites[o];a.visible&&(o>=n&&kh(a,s.path)?i=!1:ne(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return Ph(t),!0;if(s.snap)t.visibleWrites=Ca(t.visibleWrites,s.path);else{let a=s.children;W(a,l=>{t.visibleWrites=Ca(t.visibleWrites,N(s.path,l))})}return!0}else return!1}function kh(t,e){if(t.snap)return ne(t.path,e);for(let n in t.children)if(t.children.hasOwnProperty(n)&&ne(N(t.path,n),e))return!0;return!1}function Ph(t){t.visibleWrites=hl(t.allWrites,Ah,T()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Ah(t){return t.visible}function hl(t,e,n){let s=le.empty();for(let i=0;i<t.length;++i){let r=t[i];if(e(r)){let o=r.path,a;if(r.snap)ne(n,o)?(a=V(n,o),s=jt(s,a,r.snap)):ne(o,n)&&(a=V(o,n),s=jt(s,T(),r.snap.getChild(a)));else if(r.children){if(ne(n,o))a=V(n,o),s=Oi(s,a,r.children);else if(ne(o,n))if(a=V(o,n),C(a))s=Oi(s,T(),r.children);else{let l=be(r.children,w(a));if(l){let c=l.getChild(R(a));s=jt(s,T(),c)}}}else throw Xe("WriteRecord should have .snap or .children")}}return s}function dl(t,e,n,s,i){if(!s&&!i){let r=je(t.visibleWrites,e);if(r!=null)return r;{let o=Ne(t.visibleWrites,e);if(Li(o))return n;if(n==null&&!Mi(o,T()))return null;{let a=n||y.EMPTY_NODE;return ct(o,a)}}}else{let r=Ne(t.visibleWrites,e);if(!i&&Li(r))return n;if(!i&&n==null&&!Mi(r,T()))return null;{let o=function(c){return(c.visible||i)&&(!s||!~s.indexOf(c.writeId))&&(ne(c.path,e)||ne(e,c.path))},a=hl(t.allWrites,o,e),l=n||y.EMPTY_NODE;return ct(a,l)}}}function xh(t,e,n){let s=y.EMPTY_NODE,i=je(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(S,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(n){let r=Ne(t.visibleWrites,e);return n.forEachChild(S,(o,a)=>{let l=ct(Ne(r,new b(o)),a);s=s.updateImmediateChild(o,l)}),Ea(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{let r=Ne(t.visibleWrites,e);return Ea(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function Dh(t,e,n,s,i){_(s||i,"Either existingEventSnap or existingServerSnap must exist");let r=N(e,n);if(Mi(t.visibleWrites,r))return null;{let o=Ne(t.visibleWrites,r);return Li(o)?i.getChild(n):ct(o,i.getChild(n))}}function Oh(t,e,n,s){let i=N(e,n),r=je(t.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(n)){let o=Ne(t.visibleWrites,i);return ct(o,s.getNode().getImmediateChild(n))}else return null}function Mh(t,e){return je(t.visibleWrites,e)}function Lh(t,e,n,s,i,r,o){let a,l=Ne(t.visibleWrites,e),c=je(l,T());if(c!=null)a=c;else if(n!=null)a=ct(l,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o),f=d.getNext();for(;f&&u.length<i;)h(f,s)!==0&&u.push(f),f=d.getNext();return u}else return[]}function Fh(){return{visibleWrites:le.empty(),allWrites:[],lastWriteId:-1}}function Yn(t,e,n,s){return dl(t.writeTree,t.treePath,e,n,s)}function wr(t,e){return xh(t.writeTree,t.treePath,e)}function Ta(t,e,n,s){return Dh(t.writeTree,t.treePath,e,n,s)}function Xn(t,e){return Mh(t.writeTree,N(t.treePath,e))}function Uh(t,e,n,s,i,r){return Lh(t.writeTree,t.treePath,e,n,s,i,r)}function Cr(t,e,n){return Oh(t.writeTree,t.treePath,e,n)}function fl(t,e){return _l(N(t.treePath,e),t.writeTree)}function _l(t,e){return{treePath:t,writeTree:e}}var Fi=class{constructor(){this.changeMap=new Map}trackChildChange(e){let n=e.type,s=e.childName;_(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),_(s!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(s);if(i){let r=i.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(s,Qt(s,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(s,Kt(s,i.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(s,at(s,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(s,Qt(s,e.snapshotNode,i.oldSnap));else throw Xe("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}};var Ui=class{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}},pl=new Ui,Zt=class{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){let n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{let s=this.optCompleteServerCache_!=null?new me(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Cr(this.writes_,e,s)}}getChildAfterChild(e,n,s){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:$e(this.viewCache_),r=Uh(this.writes_,i,n,1,s,e);return r.length===0?null:r[0]}};function Bh(t){return{filter:t}}function Wh(t,e){_(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),_(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function $h(t,e,n,s,i){let r=new Fi,o,a;if(n.type===_e.OVERWRITE){let c=n;c.source.fromUser?o=Bi(t,e,c.path,c.snap,s,i,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!C(c.path),o=Jn(t,e,c.path,c.snap,s,i,a,r))}else if(n.type===_e.MERGE){let c=n;c.source.fromUser?o=jh(t,e,c.path,c.children,s,i,r):(_(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Wi(t,e,c.path,c.children,s,i,a,r))}else if(n.type===_e.ACK_USER_WRITE){let c=n;c.revert?o=Gh(t,e,c.path,s,i,r):o=Hh(t,e,c.path,c.affectedTree,s,i,r)}else if(n.type===_e.LISTEN_COMPLETE)o=Vh(t,e,n.path,s,r);else throw Xe("Unknown operation type: "+n.type);let l=r.getChanges();return qh(e,o,l),{viewCache:o,changes:l}}function qh(t,e,n){let s=e.eventCache;if(s.isFullyInitialized()){let i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Qn(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&n.push(ll(Qn(e)))}}function gl(t,e,n,s,i,r){let o=e.eventCache;if(Xn(s,n)!=null)return e;{let a,l;if(C(n))if(_(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=$e(e),u=c instanceof y?c:y.EMPTY_NODE,h=wr(s,u);a=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{let c=Yn(s,$e(e));a=t.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=w(n);if(c===".priority"){_(Ae(n)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let h=Ta(s,n,u,l);h!=null?a=t.filter.updatePriority(u,h):a=o.getNode()}else{let u=R(n),h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let d=Ta(s,n,o.getNode(),l);d!=null?h=o.getNode().getImmediateChild(c).updateChild(u,d):h=o.getNode().getImmediateChild(c)}else h=Cr(s,c,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),c,h,u,i,r):a=o.getNode()}}return qt(e,a,o.isFullyInitialized()||C(n),t.filter.filtersNodes())}}function Jn(t,e,n,s,i,r,o,a){let l=e.serverCache,c,u=o?t.filter:t.filter.getIndexedFilter();if(C(n))c=u.updateFullNode(l.getNode(),s,null);else if(u.filtersNodes()&&!l.isFiltered()){let f=l.getNode().updateChild(n,s);c=u.updateFullNode(l.getNode(),f,null)}else{let f=w(n);if(!l.isCompleteForPath(n)&&Ae(n)>1)return e;let p=R(n),v=l.getNode().getImmediateChild(f).updateChild(p,s);f===".priority"?c=u.updatePriority(l.getNode(),v):c=u.updateChild(l.getNode(),f,v,p,pl,null)}let h=cl(e,c,l.isFullyInitialized()||C(n),u.filtersNodes()),d=new Zt(i,h,r);return gl(t,h,n,i,d,a)}function Bi(t,e,n,s,i,r,o){let a=e.eventCache,l,c,u=new Zt(i,e,r);if(C(n))c=t.filter.updateFullNode(e.eventCache.getNode(),s,o),l=qt(e,c,!0,t.filter.filtersNodes());else{let h=w(n);if(h===".priority")c=t.filter.updatePriority(e.eventCache.getNode(),s),l=qt(e,c,a.isFullyInitialized(),a.isFiltered());else{let d=R(n),f=a.getNode().getImmediateChild(h),p;if(C(d))p=s;else{let m=u.getCompleteChild(h);m!=null?dr(d)===".priority"&&m.getChild(nl(d)).isEmpty()?p=m:p=m.updateChild(d,s):p=y.EMPTY_NODE}if(f.equals(p))l=e;else{let m=t.filter.updateChild(a.getNode(),h,p,d,u,o);l=qt(e,m,a.isFullyInitialized(),t.filter.filtersNodes())}}}return l}function ba(t,e){return t.eventCache.isCompleteForChild(e)}function jh(t,e,n,s,i,r,o){let a=e;return s.foreach((l,c)=>{let u=N(n,l);ba(e,w(u))&&(a=Bi(t,a,u,c,i,r,o))}),s.foreach((l,c)=>{let u=N(n,l);ba(e,w(u))||(a=Bi(t,a,u,c,i,r,o))}),a}function Ia(t,e,n){return n.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Wi(t,e,n,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;C(n)?c=s:c=new G(null).setTree(n,s);let u=e.serverCache.getNode();return c.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){let f=e.serverCache.getNode().getImmediateChild(h),p=Ia(t,f,d);l=Jn(t,l,new b(h),p,i,r,o,a)}}),c.children.inorderTraversal((h,d)=>{let f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!f){let p=e.serverCache.getNode().getImmediateChild(h),m=Ia(t,p,d);l=Jn(t,l,new b(h),m,i,r,o,a)}}),l}function Hh(t,e,n,s,i,r,o){if(Xn(i,n)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(s.value!=null){if(C(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return Jn(t,e,n,l.getNode().getChild(n),i,r,a,o);if(C(n)){let c=new G(null);return l.getNode().forEachChild(pe,(u,h)=>{c=c.set(new b(u),h)}),Wi(t,e,n,c,i,r,a,o)}else return e}else{let c=new G(null);return s.foreach((u,h)=>{let d=N(n,u);l.isCompleteForPath(d)&&(c=c.set(u,l.getNode().getChild(d)))}),Wi(t,e,n,c,i,r,a,o)}}function Vh(t,e,n,s,i){let r=e.serverCache,o=cl(e,r.getNode(),r.isFullyInitialized()||C(n),r.isFiltered());return gl(t,o,n,s,pl,i)}function Gh(t,e,n,s,i,r){let o;if(Xn(s,n)!=null)return e;{let a=new Zt(s,e,i),l=e.eventCache.getNode(),c;if(C(n)||w(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Yn(s,$e(e));else{let h=e.serverCache.getNode();_(h instanceof y,"serverChildren would be complete if leaf node"),u=wr(s,h)}u=u,c=t.filter.updateFullNode(l,u,r)}else{let u=w(n),h=Cr(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=l.getImmediateChild(u)),h!=null?c=t.filter.updateChild(l,u,h,R(n),a,r):e.eventCache.getNode().hasChild(u)?c=t.filter.updateChild(l,u,y.EMPTY_NODE,R(n),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Yn(s,$e(e)),o.isLeafNode()&&(c=t.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||Xn(s,T())!=null,qt(e,c,o,t.filter.filtersNodes())}}var $i=class{constructor(e,n){this.query_=e,this.eventRegistrations_=[];let s=this.query_._queryParams,i=new Yt(s.getIndex()),r=fh(s);this.processor_=Bh(r);let o=n.serverCache,a=n.eventCache,l=i.updateFullNode(y.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(y.EMPTY_NODE,a.getNode(),null),u=new me(l,o.isFullyInitialized(),i.filtersNodes()),h=new me(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=ds(h,u),this.eventGenerator_=new Di(this.query_)}get query(){return this.query_}};function zh(t){return t.viewCache_.serverCache.getNode()}function Kh(t){return Qn(t.viewCache_)}function Qh(t,e){let n=$e(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!C(e)&&!n.getImmediateChild(w(e)).isEmpty())?n.getChild(e):null}function Ra(t){return t.eventRegistrations_.length===0}function Yh(t,e){t.eventRegistrations_.push(e)}function Sa(t,e,n){let s=[];if(n){_(e==null,"A cancel should cancel all event registrations.");let i=t.query._path;t.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(n,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){let o=t.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function Na(t,e,n,s){e.type===_e.MERGE&&e.source.queryId!==null&&(_($e(t.viewCache_),"We should always have a full cache before handling merges"),_(Qn(t.viewCache_),"Missing event cache, even though we have a server cache"));let i=t.viewCache_,r=$h(t.processor_,i,e,n,s);return Wh(t.processor_,r.viewCache),_(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,ml(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Xh(t,e){let n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(S,(r,o)=>{s.push(at(r,o))}),n.isFullyInitialized()&&s.push(ll(n.getNode())),ml(t,s,n.getNode(),e)}function ml(t,e,n,s){let i=s?[s]:t.eventRegistrations_;return Ch(t.eventGenerator_,e,n,i)}var Zn,es=class{constructor(){this.views=new Map}};function Jh(t){_(!Zn,"__referenceConstructor has already been defined"),Zn=t}function Zh(){return _(Zn,"Reference.ts has not been loaded"),Zn}function ed(t){return t.views.size===0}function Er(t,e,n,s){let i=e.source.queryId;if(i!==null){let r=t.views.get(i);return _(r!=null,"SyncTree gave us an op for an invalid query."),Na(r,e,n,s)}else{let r=[];for(let o of t.views.values())r=r.concat(Na(o,e,n,s));return r}}function yl(t,e,n,s,i){let r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Yn(n,i?s:null),l=!1;a?l=!0:s instanceof y?(a=wr(n,s),l=!1):(a=y.EMPTY_NODE,l=!1);let c=ds(new me(a,l,!1),new me(s,i,!1));return new $i(e,c)}return o}function td(t,e,n,s,i,r){let o=yl(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Yh(o,n),Xh(o,n)}function nd(t,e,n,s){let i=e._queryIdentifier,r=[],o=[],a=xe(t);if(i==="default")for(let[l,c]of t.views.entries())o=o.concat(Sa(c,n,s)),Ra(c)&&(t.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=t.views.get(i);l&&(o=o.concat(Sa(l,n,s)),Ra(l)&&(t.views.delete(i),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!xe(t)&&r.push(new(Zh())(e._repo,e._path)),{removed:r,events:o}}function vl(t){let e=[];for(let n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function ke(t,e){let n=null;for(let s of t.views.values())n=n||Qh(s,e);return n}function wl(t,e){if(e._queryParams.loadsAllData())return _s(t);{let s=e._queryIdentifier;return t.views.get(s)}}function Cl(t,e){return wl(t,e)!=null}function xe(t){return _s(t)!=null}function _s(t){for(let e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var ts;function sd(t){_(!ts,"__referenceConstructor has already been defined"),ts=t}function id(){return _(ts,"Reference.ts has not been loaded"),ts}var rd=1,ns=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new G(null),this.pendingWriteTree_=Fh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Tr(t,e,n,s,i){return Ih(t.pendingWriteTree_,e,n,s,i),i?_t(t,new lt(mr(),e,n)):[]}function od(t,e,n,s){Rh(t.pendingWriteTree_,e,n,s);let i=G.fromObject(n);return _t(t,new Jt(mr(),e,i))}function Se(t,e,n=!1){let s=Sh(t.pendingWriteTree_,e);if(Nh(t.pendingWriteTree_,e)){let r=new G(null);return s.snap!=null?r=r.set(T(),!0):W(s.children,o=>{r=r.set(new b(o),!0)}),_t(t,new xi(s.path,r,n))}else return[]}function cn(t,e,n){return _t(t,new lt(yr(),e,n))}function ad(t,e,n){let s=G.fromObject(n);return _t(t,new Jt(yr(),e,s))}function ld(t,e){return _t(t,new Kn(yr(),e))}function cd(t,e,n){let s=br(t,n);if(s){let i=Ir(s),r=i.path,o=i.queryId,a=V(r,e),l=new Kn(vr(o),a);return Rr(t,r,l)}else return[]}function ss(t,e,n,s,i=!1){let r=e._path,o=t.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||Cl(o,e))){let l=nd(o,e,n,s);ed(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!i){let u=c.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(d,f)=>xe(f));if(u&&!h){let d=t.syncPointTree_.subtree(r);if(!d.isEmpty()){let f=dd(d);for(let p=0;p<f.length;++p){let m=f[p],v=m.query,O=Il(t,m);t.listenProvider_.startListening(Ht(v),en(t,v),O.hashFn,O.onComplete)}}}!h&&c.length>0&&!s&&(u?t.listenProvider_.stopListening(Ht(e),null):c.forEach(d=>{let f=t.queryToTagMap.get(gs(d));t.listenProvider_.stopListening(Ht(d),f)}))}fd(t,c)}return a}function El(t,e,n,s){let i=br(t,s);if(i!=null){let r=Ir(i),o=r.path,a=r.queryId,l=V(o,e),c=new lt(vr(a),l,n);return Rr(t,o,c)}else return[]}function ud(t,e,n,s){let i=br(t,s);if(i){let r=Ir(i),o=r.path,a=r.queryId,l=V(o,e),c=G.fromObject(n),u=new Jt(vr(a),l,c);return Rr(t,o,u)}else return[]}function qi(t,e,n,s=!1){let i=e._path,r=null,o=!1;t.syncPointTree_.foreachOnPath(i,(d,f)=>{let p=V(d,i);r=r||ke(f,p),o=o||xe(f)});let a=t.syncPointTree_.get(i);a?(o=o||xe(a),r=r||ke(a,T())):(a=new es,t.syncPointTree_=t.syncPointTree_.set(i,a));let l;r!=null?l=!0:(l=!1,r=y.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((f,p)=>{let m=ke(p,T());m&&(r=r.updateImmediateChild(f,m))}));let c=Cl(a,e);if(!c&&!e._queryParams.loadsAllData()){let d=gs(e);_(!t.queryToTagMap.has(d),"View does not exist, but we have a tag");let f=_d();t.queryToTagMap.set(d,f),t.tagToQueryMap.set(f,d)}let u=fs(t.pendingWriteTree_,i),h=td(a,e,n,u,r,l);if(!c&&!o&&!s){let d=wl(a,e);h=h.concat(pd(t,e,d))}return h}function ps(t,e,n){let i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{let l=V(o,e),c=ke(a,l);if(c)return c});return dl(i,e,r,n,!0)}function hd(t,e){let n=e._path,s=null;t.syncPointTree_.foreachOnPath(n,(c,u)=>{let h=V(c,n);s=s||ke(u,h)});let i=t.syncPointTree_.get(n);i?s=s||ke(i,T()):(i=new es,t.syncPointTree_=t.syncPointTree_.set(n,i));let r=s!=null,o=r?new me(s,!0,!1):null,a=fs(t.pendingWriteTree_,e._path),l=yl(i,e,a,r?o.getNode():y.EMPTY_NODE,r);return Kh(l)}function _t(t,e){return Tl(e,t.syncPointTree_,null,fs(t.pendingWriteTree_,T()))}function Tl(t,e,n,s){if(C(t.path))return bl(t,e,n,s);{let i=e.get(T());n==null&&i!=null&&(n=ke(i,T()));let r=[],o=w(t.path),a=t.operationForChild(o),l=e.children.get(o);if(l&&a){let c=n?n.getImmediateChild(o):null,u=fl(s,o);r=r.concat(Tl(a,l,c,u))}return i&&(r=r.concat(Er(i,t,s,n))),r}}function bl(t,e,n,s){let i=e.get(T());n==null&&i!=null&&(n=ke(i,T()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=n?n.getImmediateChild(o):null,c=fl(s,o),u=t.operationForChild(o);u&&(r=r.concat(bl(u,a,l,c)))}),i&&(r=r.concat(Er(i,t,s,n))),r}function Il(t,e){let n=e.query,s=en(t,n);return{hashFn:()=>(zh(e)||y.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?cd(t,n._path,s):ld(t,n._path);{let r=Iu(i,n);return ss(t,n,null,r)}}}}function en(t,e){let n=gs(e);return t.queryToTagMap.get(n)}function gs(t){return t._path.toString()+"$"+t._queryIdentifier}function br(t,e){return t.tagToQueryMap.get(e)}function Ir(t){let e=t.indexOf("$");return _(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new b(t.substr(0,e))}}function Rr(t,e,n){let s=t.syncPointTree_.get(e);_(s,"Missing sync point for query tag that we're tracking");let i=fs(t.pendingWriteTree_,e);return Er(s,n,i,null)}function dd(t){return t.fold((e,n,s)=>{if(n&&xe(n))return[_s(n)];{let i=[];return n&&(i=vl(n)),W(s,(r,o)=>{i=i.concat(o)}),i}})}function Ht(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(id())(t._repo,t._path):t}function fd(t,e){for(let n=0;n<e.length;++n){let s=e[n];if(!s._queryParams.loadsAllData()){let i=gs(s),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function _d(){return rd++}function pd(t,e,n){let s=e._path,i=en(t,e),r=Il(t,n),o=t.listenProvider_.startListening(Ht(e),i,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(s);if(i)_(!xe(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,h)=>{if(!C(c)&&u&&xe(u))return[_s(u).query];{let d=[];return u&&(d=d.concat(vl(u).map(f=>f.query))),W(h,(f,p)=>{d=d.concat(p)}),d}});for(let c=0;c<l.length;++c){let u=l[c];t.listenProvider_.stopListening(Ht(u),en(t,u))}}return o}var ji=class t{constructor(e){this.node_=e}getImmediateChild(e){let n=this.node_.getImmediateChild(e);return new t(n)}node(){return this.node_}},Hi=class t{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){let n=N(this.path_,e);return new t(this.syncTree_,n)}node(){return ps(this.syncTree_,this.path_)}},gd=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},ka=function(t,e,n){if(!t||typeof t!="object")return t;if(_(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return md(t[".sv"],e,n);if(typeof t[".sv"]=="object")return yd(t[".sv"],e);_(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},md=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:_(!1,"Unexpected server value: "+t)}},yd=function(t,e,n){t.hasOwnProperty("increment")||_(!1,"Unexpected server value: "+JSON.stringify(t,null,2));let s=t.increment;typeof s!="number"&&_(!1,"Unexpected increment value: "+s);let i=e.node();if(_(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;let o=i.getValue();return typeof o!="number"?s:o+s},Rl=function(t,e,n,s){return Nr(e,new Hi(n,t),s)},Sr=function(t,e,n){return Nr(t,new ji(e),n)};function Nr(t,e,n){let s=t.getPriority().val(),i=ka(s,e.getImmediateChild(".priority"),n),r;if(t.isLeafNode()){let o=t,a=ka(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new rt(a,x(i)):t}else{let o=t;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new rt(i))),o.forEachChild(S,(a,l)=>{let c=Nr(l,e.getImmediateChild(a),n);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var tn=class{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}};function ms(t,e){let n=e instanceof b?e:new b(e),s=t,i=w(n);for(;i!==null;){let r=be(s.node.children,i)||{children:{},childCount:0};s=new tn(i,s,r),n=R(n),i=w(n)}return s}function He(t){return t.node.value}function kr(t,e){t.node.value=e,Vi(t)}function Sl(t){return t.node.childCount>0}function vd(t){return He(t)===void 0&&!Sl(t)}function ys(t,e){W(t.node.children,(n,s)=>{e(new tn(n,t,s))})}function Nl(t,e,n,s){n&&!s&&e(t),ys(t,i=>{Nl(i,e,!0,s)}),n&&s&&e(t)}function wd(t,e,n){let s=n?t:t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function un(t){return new b(t.parent===null?t.name:un(t.parent)+"/"+t.name)}function Vi(t){t.parent!==null&&Cd(t.parent,t.name,t)}function Cd(t,e,n){let s=vd(n),i=te(t.node.children,e);s&&i?(delete t.node.children[e],t.node.childCount--,Vi(t)):!s&&!i&&(t.node.children[e]=n.node,t.node.childCount++,Vi(t))}var Ed=/[\[\].#$\/\u0000-\u001F\u007F]/,Td=/[\[\].#$\u0000-\u001F\u007F]/,ni=10*1024*1024,vs=function(t){return typeof t=="string"&&t.length!==0&&!Ed.test(t)},kl=function(t){return typeof t=="string"&&t.length!==0&&!Td.test(t)},bd=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),kl(t)},nn=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!us(t)||t&&typeof t=="object"&&te(t,".sv")},ye=function(t,e,n,s){s&&e===void 0||hn(Q(t,"value"),e,n)},hn=function(t,e,n){let s=n instanceof b?new pi(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Ue(s));if(typeof e=="function")throw new Error(t+"contains a function "+Ue(s)+" with contents = "+e.toString());if(us(e))throw new Error(t+"contains "+e.toString()+" "+Ue(s));if(typeof e=="string"&&e.length>ni/3&&Dt(e)>ni)throw new Error(t+"contains a string greater than "+ni+" utf8 bytes "+Ue(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(W(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!vs(o)))throw new Error(t+" contains an invalid key ("+o+") "+Ue(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);eh(s,o),hn(t,a,s),th(s)}),i&&r)throw new Error(t+' contains ".value" child '+Ue(s)+" in addition to actual children.")}},Id=function(t,e){let n,s;for(n=0;n<e.length;n++){s=e[n];let r=Gt(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!vs(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Zu);let i=null;for(n=0;n<e.length;n++){if(s=e[n],i!==null&&ne(i,s))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},Pl=function(t,e,n,s){if(s&&e===void 0)return;let i=Q(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let r=[];W(e,(o,a)=>{let l=new b(o);if(hn(i,a,N(n,l)),dr(l)===".priority"&&!nn(a))throw new Error(i+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),Id(i,r)},Pr=function(t,e,n){if(!(n&&e===void 0)){if(us(e))throw new Error(Q(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!nn(e))throw new Error(Q(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},dn=function(t,e,n,s){if(!(s&&n===void 0)&&!vs(n))throw new Error(Q(t,e)+'was an invalid key = "'+n+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},pt=function(t,e,n,s){if(!(s&&n===void 0)&&!kl(n))throw new Error(Q(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Rd=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),pt(t,e,n,s)},Y=function(t,e){if(w(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},Al=function(t,e){let n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!vs(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!bd(n))throw new Error(Q(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var Gi=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function ws(t,e){let n=null;for(let s=0;s<e.length;s++){let i=e[s],r=i.getPath();n!==null&&!fr(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(i)}n&&t.eventLists_.push(n)}function xl(t,e,n){ws(t,n),Dl(t,s=>fr(s,e))}function X(t,e,n){ws(t,n),Dl(t,s=>ne(s,e)||ne(e,s))}function Dl(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){let i=t.eventLists_[s];if(i){let r=i.path;e(r)?(Sd(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function Sd(t){for(let e=0;e<t.events.length;e++){let n=t.events[e];if(n!==null){t.events[e]=null;let s=n.getEventRunner();We&&B("event: "+n.toString()),dt(s)}}}var Ol="repo_interrupt",Nd=25,zi=class{constructor(e,n,s,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gi,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=zn(),this.transactionQueueTree_=new tn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function kd(t,e,n){if(t.stats_=hr(t.repoInfo_),t.forceRestClient_||ku())t.server_=new Ri(t.repoInfo_,(s,i,r,o)=>{Pa(t,s,i,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>Aa(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{M(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new _r(t.repoInfo_,e,(s,i,r,o)=>{Pa(t,s,i,r,o)},s=>{Aa(t,s)},s=>{Pd(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=Au(t.repoInfo_,()=>new Ai(t.stats_,t.server_)),t.infoData_=new Si,t.infoSyncTree_=new ns({startListening:(s,i,r,o)=>{let a=[],l=t.infoData_.getNode(s._path);return l.isEmpty()||(a=cn(t.infoSyncTree_,s._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Ar(t,"connected",!1),t.serverSyncTree_=new ns({startListening:(s,i,r,o)=>(t.server_.listen(s,r,i,(a,l)=>{let c=o(a,l);X(t.eventQueue_,s._path,c)}),[]),stopListening:(s,i)=>{t.server_.unlisten(s,i)}})}function Ml(t){let n=t.infoData_.getNode(new b(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function fn(t){return gd({timestamp:Ml(t)})}function Pa(t,e,n,s,i){t.dataUpdateCount++;let r=new b(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(s){let l=xt(n,c=>x(c));o=ud(t.serverSyncTree_,r,l,i)}else{let l=x(n);o=El(t.serverSyncTree_,r,l,i)}else if(s){let l=xt(n,c=>x(c));o=ad(t.serverSyncTree_,r,l)}else{let l=x(n);o=cn(t.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=ut(t,r)),X(t.eventQueue_,a,o)}function Aa(t,e){Ar(t,"connected",e),e===!1&&Dd(t)}function Pd(t,e){W(e,(n,s)=>{Ar(t,n,s)})}function Ar(t,e,n){let s=new b("/.info/"+e),i=x(n);t.infoData_.updateSnapshot(s,i);let r=cn(t.infoSyncTree_,s,i);X(t.eventQueue_,s,r)}function Cs(t){return t.nextWriteId_++}function Ad(t,e,n){let s=hd(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(i=>{let r=x(i).withIndex(e._queryParams.getIndex());qi(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=cn(t.serverSyncTree_,e._path,r);else{let a=en(t.serverSyncTree_,e);o=El(t.serverSyncTree_,e._path,r,a)}return X(t.eventQueue_,e._path,o),ss(t.serverSyncTree_,e,n,null,!0),r},i=>(gt(t,"get for query "+M(e)+" failed: "+i),Promise.reject(new Error(i))))}function xr(t,e,n,s,i){gt(t,"set",{path:e.toString(),value:n,priority:s});let r=fn(t),o=x(n,s),a=ps(t.serverSyncTree_,e),l=Sr(o,a,r),c=Cs(t),u=Tr(t.serverSyncTree_,e,l,c,!0);ws(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(d,f)=>{let p=d==="ok";p||q("set at "+e+" failed: "+d);let m=Se(t.serverSyncTree_,c,!p);X(t.eventQueue_,e,m),De(t,i,d,f)});let h=Or(t,e);ut(t,h),X(t.eventQueue_,h,[])}function xd(t,e,n,s){gt(t,"update",{path:e.toString(),value:n});let i=!0,r=fn(t),o={};if(W(n,(a,l)=>{i=!1,o[a]=Rl(N(e,a),x(l),t.serverSyncTree_,r)}),i)B("update() called with empty data.  Don't do anything."),De(t,s,"ok",void 0);else{let a=Cs(t),l=od(t.serverSyncTree_,e,o,a);ws(t.eventQueue_,l),t.server_.merge(e.toString(),n,(c,u)=>{let h=c==="ok";h||q("update at "+e+" failed: "+c);let d=Se(t.serverSyncTree_,a,!h),f=d.length>0?ut(t,e):e;X(t.eventQueue_,f,d),De(t,s,c,u)}),W(n,c=>{let u=Or(t,N(e,c));ut(t,u)}),X(t.eventQueue_,e,[])}}function Dd(t){gt(t,"onDisconnectEvents");let e=fn(t),n=zn();ki(t.onDisconnect_,T(),(i,r)=>{let o=Rl(i,r,t.serverSyncTree_,e);ft(n,i,o)});let s=[];ki(n,T(),(i,r)=>{s=s.concat(cn(t.serverSyncTree_,i,r));let o=Or(t,i);ut(t,o)}),t.onDisconnect_=zn(),X(t.eventQueue_,T(),s)}function Od(t,e,n){t.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&Ni(t.onDisconnect_,e),De(t,n,s,i)})}function xa(t,e,n,s){let i=x(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&ft(t.onDisconnect_,e,i),De(t,s,r,o)})}function Md(t,e,n,s,i){let r=x(n,s);t.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&ft(t.onDisconnect_,e,r),De(t,i,o,a)})}function Ld(t,e,n,s){if(Sn(n)){B("onDisconnect().update() called with empty data.  Don't do anything."),De(t,s,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(i,r)=>{i==="ok"&&W(n,(o,a)=>{let l=x(a);ft(t.onDisconnect_,N(e,o),l)}),De(t,s,i,r)})}function Fd(t,e,n){let s;w(e._path)===".info"?s=qi(t.infoSyncTree_,e,n):s=qi(t.serverSyncTree_,e,n),xl(t.eventQueue_,e._path,s)}function Ki(t,e,n){let s;w(e._path)===".info"?s=ss(t.infoSyncTree_,e,n):s=ss(t.serverSyncTree_,e,n),xl(t.eventQueue_,e._path,s)}function Ll(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Ol)}function Ud(t){t.persistentConnection_&&t.persistentConnection_.resume(Ol)}function gt(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),B(n,...e)}function De(t,e,n,s){e&&dt(()=>{if(n==="ok")e(null);else{let i=(n||"error").toUpperCase(),r=i;s&&(r+=": "+s);let o=new Error(r);o.code=i,e(o)}})}function Bd(t,e,n,s,i,r){gt(t,"transaction on "+e);let o={path:e,update:n,onComplete:s,status:null,order:Ma(),applyLocally:r,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Dr(t,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{hn("transaction failed: Data returned ",l,o.path),o.status=0;let c=ms(t.transactionQueueTree_,e),u=He(c)||[];u.push(o),kr(c,u);let h;typeof l=="object"&&l!==null&&te(l,".priority")?(h=be(l,".priority"),_(nn(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(ps(t.serverSyncTree_,e)||y.EMPTY_NODE).getPriority().val();let d=fn(t),f=x(l,h),p=Sr(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=Cs(t);let m=Tr(t.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);X(t.eventQueue_,e,m),Es(t,t.transactionQueueTree_)}}function Dr(t,e,n){return ps(t.serverSyncTree_,e,n)||y.EMPTY_NODE}function Es(t,e=t.transactionQueueTree_){if(e||Ts(t,e),He(e)){let n=Ul(t,e);_(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&Wd(t,un(e),n)}else Sl(e)&&ys(e,n=>{Es(t,n)})}function Wd(t,e,n){let s=n.map(c=>c.currentWriteId),i=Dr(t,e,s),r=i,o=i.hash();for(let c=0;c<n.length;c++){let u=n[c];_(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let h=V(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;t.server_.put(l.toString(),a,c=>{gt(t,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let h=[];for(let d=0;d<n.length;d++)n[d].status=2,u=u.concat(Se(t.serverSyncTree_,n[d].currentWriteId)),n[d].onComplete&&h.push(()=>n[d].onComplete(null,!0,n[d].currentOutputSnapshotResolved)),n[d].unwatcher();Ts(t,ms(t.transactionQueueTree_,e)),Es(t,t.transactionQueueTree_),X(t.eventQueue_,e,u);for(let d=0;d<h.length;d++)dt(h[d])}else{if(c==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{q("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=c}ut(t,e)}},o)}function ut(t,e){let n=Fl(t,e),s=un(n),i=Ul(t,n);return $d(t,i,s),s}function $d(t,e,n){if(e.length===0)return;let s=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=V(n,l.path),u=!1,h;if(_(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,h=l.abortReason,i=i.concat(Se(t.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Nd)u=!0,h="maxretry",i=i.concat(Se(t.serverSyncTree_,l.currentWriteId,!0));else{let d=Dr(t,l.path,o);l.currentInputSnapshot=d;let f=e[a].update(d.val());if(f!==void 0){hn("transaction failed: Data returned ",f,l.path);let p=x(f);typeof f=="object"&&f!=null&&te(f,".priority")||(p=p.updatePriority(d.getPriority()));let v=l.currentWriteId,O=fn(t),L=Sr(p,d,O);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=L,l.currentWriteId=Cs(t),o.splice(o.indexOf(v),1),i=i.concat(Tr(t.serverSyncTree_,l.path,L,l.currentWriteId,l.applyLocally)),i=i.concat(Se(t.serverSyncTree_,v,!0))}else u=!0,h="nodata",i=i.concat(Se(t.serverSyncTree_,l.currentWriteId,!0))}X(t.eventQueue_,n,i),i=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(h),!1,null))))}Ts(t,t.transactionQueueTree_);for(let a=0;a<s.length;a++)dt(s[a]);Es(t,t.transactionQueueTree_)}function Fl(t,e){let n,s=t.transactionQueueTree_;for(n=w(e);n!==null&&He(s)===void 0;)s=ms(s,n),e=R(e),n=w(e);return s}function Ul(t,e){let n=[];return Bl(t,e,n),n.sort((s,i)=>s.order-i.order),n}function Bl(t,e,n){let s=He(e);if(s)for(let i=0;i<s.length;i++)n.push(s[i]);ys(e,i=>{Bl(t,i,n)})}function Ts(t,e){let n=He(e);if(n){let s=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[s]=n[i],s++);n.length=s,kr(e,n.length>0?n:void 0)}ys(e,s=>{Ts(t,s)})}function Or(t,e){let n=un(Fl(t,e)),s=ms(t.transactionQueueTree_,e);return wd(s,i=>{si(t,i)}),si(t,s),Nl(s,i=>{si(t,i)}),n}function si(t,e){let n=He(e);if(n){let s=[],i=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(_(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(_(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(Se(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?kr(e,void 0):n.length=r+1,X(t.eventQueue_,un(e),i);for(let o=0;o<s.length;o++)dt(s[o])}}function qd(t){let e="",n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let i=n[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function jd(t){let e={};t.charAt(0)==="?"&&(t=t.substring(1));for(let n of t.split("&")){if(n.length===0)continue;let s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):q(`Invalid query segment '${n}' in query '${t}'`)}return e}var Qi=function(t,e){let n=Hd(t),s=n.namespace;n.domain==="firebase.com"&&ge(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&ge("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||wu();let i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Bn(n.host,n.secure,s,i,e,"",s!==n.subdomain),path:new b(n.pathString)}},Hd=function(t){let e="",n="",s="",i="",r="",o=!0,a="https",l=443;if(typeof t=="string"){let c=t.indexOf("//");c>=0&&(a=t.substring(0,c-1),t=t.substring(c+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(i=qd(t.substring(u,h)));let d=jd(t.substring(Math.min(t.length,h)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let f=e.slice(0,c);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{let p=e.indexOf(".");s=e.substring(0,p).toLowerCase(),n=e.substring(p+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:l,domain:n,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};var Da="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Vd=function(){let t=0,e=[];return function(n){let s=n===t;t=n;let i,r=new Array(8);for(i=7;i>=0;i--)r[i]=Da.charAt(n%64),n=Math.floor(n/64);_(n===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=Da.charAt(e[i]);return _(o.length===20,"nextPushId: Length should be 20."),o}}();var is=class{constructor(e,n,s,i){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+M(this.snapshot.exportVal())}},rs=class{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var sn=class{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return _(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var os=class{constructor(e,n){this._repo=e,this._path=n}cancel(){let e=new H;return Od(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Y("OnDisconnect.remove",this._path);let e=new H;return xa(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Y("OnDisconnect.set",this._path),ye("OnDisconnect.set",e,this._path,!1);let n=new H;return xa(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){Y("OnDisconnect.setWithPriority",this._path),ye("OnDisconnect.setWithPriority",e,this._path,!1),Pr("OnDisconnect.setWithPriority",n,!1);let s=new H;return Md(this._repo,this._path,e,n,s.wrapCallback(()=>{})),s.promise}update(e){Y("OnDisconnect.update",this._path),Pl("OnDisconnect.update",e,this._path,!1);let n=new H;return Ld(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}};var z=class t{constructor(e,n,s,i){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=i}get key(){return C(this._path)?null:dr(this._path)}get ref(){return new J(this._repo,this._path)}get _queryIdentifier(){let e=va(this._queryParams),n=ur(e);return n==="{}"?"default":n}get _queryObject(){return va(this._queryParams)}isEqual(e){if(e=A(e),!(e instanceof t))return!1;let n=this._repo===e._repo,s=fr(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Ju(this._path)}};function bs(t,e){if(t._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Me(t){let e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===pe){let s="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==Pe)throw new Error(s);if(typeof e!="string")throw new Error(i)}if(t.hasEnd()){if(t.getIndexEndName()!==Ee)throw new Error(s);if(typeof n!="string")throw new Error(i)}}else if(t.getIndex()===S){if(e!=null&&!nn(e)||n!=null&&!nn(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(_(t.getIndex()instanceof zt||t.getIndex()===gr,"unknown index type."),e!=null&&typeof e=="object"||n!=null&&typeof n=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Is(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var J=class t extends z{constructor(e,n){super(e,n,new Xt,!1)}get parent(){let e=nl(this._path);return e===null?null:new t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},ht=class t{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let n=new b(e),s=Oe(this.ref,e);return new t(this._node.getChild(n),s,S)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new t(i,Oe(this.ref,s),S)))}hasChild(e){let n=new b(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Mr(t,e){return t=A(t),t._checkNotDeleted("ref"),e!==void 0?Oe(t._root,e):t._root}function Lr(t,e){t=A(t),t._checkNotDeleted("refFromURL");let n=Qi(e,t._repo.repoInfo_.nodeAdmin);Al("refFromURL",n);let s=n.repoInfo;return!t._repo.repoInfo_.isCustomHost()&&s.host!==t._repo.repoInfo_.host&&ge("refFromURL: Host name does not match the current database: (found "+s.host+" but expected "+t._repo.repoInfo_.host+")"),Mr(t,n.path.toString())}function Oe(t,e){return t=A(t),w(t._path)===null?Rd("child","path",e,!1):pt("child","path",e,!1),new J(t._repo,N(t._path,e))}function Wl(t,e){t=A(t),Y("push",t._path),ye("push",e,t._path,!0);let n=Ml(t._repo),s=Vd(n),i=Oe(t,s),r=Oe(t,s),o;return e!=null?o=Rs(r,e).then(()=>r):o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function $l(t){return Y("remove",t._path),Rs(t,null)}function Rs(t,e){t=A(t),Y("set",t._path),ye("set",e,t._path,!1);let n=new H;return xr(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function ql(t,e){t=A(t),Y("setPriority",t._path),Pr("setPriority",e,!1);let n=new H;return xr(t._repo,N(t._path,".priority"),e,null,n.wrapCallback(()=>{})),n.promise}function jl(t,e,n){if(Y("setWithPriority",t._path),ye("setWithPriority",e,t._path,!1),Pr("setWithPriority",n,!1),t.key===".length"||t.key===".keys")throw"setWithPriority failed: "+t.key+" is a read-only object.";let s=new H;return xr(t._repo,t._path,e,n,s.wrapCallback(()=>{})),s.promise}function Hl(t,e){Pl("update",e,t._path,!1);let n=new H;return xd(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Vl(t){t=A(t);let e=new sn(()=>{}),n=new rn(e);return Ad(t._repo,t,n).then(s=>new ht(s,new J(t._repo,t._path),t._queryParams.getIndex()))}var rn=class t{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){let s=n._queryParams.getIndex();return new is("value",this,new ht(e.snapshotNode,new J(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new rs(this,e,n):null}matches(e){return e instanceof t?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},as=class t{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new rs(this,e,n):null}createEvent(e,n){_(e.childName!=null,"Child events should have a childName.");let s=Oe(new J(n._repo,n._path),e.childName),i=n._queryParams.getIndex();return new is(e.type,this,new ht(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof t?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function _n(t,e,n,s,i){let r;if(typeof s=="object"&&(r=void 0,i=s),typeof s=="function"&&(r=s),i&&i.onlyOnce){let l=n,c=(u,h)=>{Ki(t._repo,t,a),l(u,h)};c.userCallback=n.userCallback,c.context=n.context,n=c}let o=new sn(n,r||void 0),a=e==="value"?new rn(o):new as(e,o);return Fd(t._repo,t,a),()=>Ki(t._repo,t,a)}function Ss(t,e,n,s){return _n(t,"value",e,n,s)}function Fr(t,e,n,s){return _n(t,"child_added",e,n,s)}function Ur(t,e,n,s){return _n(t,"child_changed",e,n,s)}function Br(t,e,n,s){return _n(t,"child_moved",e,n,s)}function Wr(t,e,n,s){return _n(t,"child_removed",e,n,s)}function $r(t,e,n){let s=null,i=n?new sn(n):null;e==="value"?s=new rn(i):e&&(s=new as(e,i)),Ki(t._repo,t,s)}var Z=class{},ls=class extends Z{constructor(e,n){super(),this._value=e,this._key=n,this.type="endAt"}_apply(e){ye("endAt",this._value,e._path,!0);let n=Ii(e._queryParams,this._value,this._key);if(Is(n),Me(n),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new z(e._repo,e._path,n,e._orderByCalled)}};function Gl(t,e){return dn("endAt","key",e,!0),new ls(t,e)}var Yi=class extends Z{constructor(e,n){super(),this._value=e,this._key=n,this.type="endBefore"}_apply(e){ye("endBefore",this._value,e._path,!1);let n=mh(e._queryParams,this._value,this._key);if(Is(n),Me(n),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new z(e._repo,e._path,n,e._orderByCalled)}};function zl(t,e){return dn("endBefore","key",e,!0),new Yi(t,e)}var cs=class extends Z{constructor(e,n){super(),this._value=e,this._key=n,this.type="startAt"}_apply(e){ye("startAt",this._value,e._path,!0);let n=bi(e._queryParams,this._value,this._key);if(Is(n),Me(n),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new z(e._repo,e._path,n,e._orderByCalled)}};function Kl(t=null,e){return dn("startAt","key",e,!0),new cs(t,e)}var Xi=class extends Z{constructor(e,n){super(),this._value=e,this._key=n,this.type="startAfter"}_apply(e){ye("startAfter",this._value,e._path,!1);let n=gh(e._queryParams,this._value,this._key);if(Is(n),Me(n),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new z(e._repo,e._path,n,e._orderByCalled)}};function Ql(t,e){return dn("startAfter","key",e,!0),new Xi(t,e)}var Ji=class extends Z{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new z(e._repo,e._path,_h(e._queryParams,this._limit),e._orderByCalled)}};function Yl(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new Ji(t)}var Zi=class extends Z{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new z(e._repo,e._path,ph(e._queryParams,this._limit),e._orderByCalled)}};function Xl(t){if(typeof t!="number"||Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Zi(t)}var er=class extends Z{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){bs(e,"orderByChild");let n=new b(this._path);if(C(n))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let s=new zt(n),i=hs(e._queryParams,s);return Me(i),new z(e._repo,e._path,i,!0)}};function Jl(t){if(t==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(t==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(t==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return pt("orderByChild","path",t,!1),new er(t)}var tr=class extends Z{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){bs(e,"orderByKey");let n=hs(e._queryParams,pe);return Me(n),new z(e._repo,e._path,n,!0)}};function Zl(){return new tr}var nr=class extends Z{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){bs(e,"orderByPriority");let n=hs(e._queryParams,S);return Me(n),new z(e._repo,e._path,n,!0)}};function ec(){return new nr}var sr=class extends Z{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){bs(e,"orderByValue");let n=hs(e._queryParams,gr);return Me(n),new z(e._repo,e._path,n,!0)}};function tc(){return new sr}var ir=class extends Z{constructor(e,n){super(),this._value=e,this._key=n,this.type="equalTo"}_apply(e){if(ye("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new ls(this._value,this._key)._apply(new cs(this._value,this._key)._apply(e))}};function nc(t,e){return dn("equalTo","key",e,!0),new ir(t,e)}function ie(t,...e){let n=A(t);for(let s of e)n=s._apply(n);return n}Jh(J);sd(J);var Gd="FIREBASE_DATABASE_EMULATOR_HOST",rr={},zd=!1;function Kd(t,e,n,s){t.repoInfo_=new Bn(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function qr(t,e,n,s,i){let r=s||t.options.databaseURL;r===void 0&&(t.options.projectId||ge("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),B("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Qi(r,i),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Gd]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Qi(r,i),a=o.repoInfo):l=!o.repoInfo.secure;let u=i&&l?new $t($t.OWNER):new ci(t.name,t.options,e);Al("Invalid Firebase Database URL",o),C(o.path)||ge("Database URL must point to the root of a Firebase Database (not including a child path).");let h=Yd(a,t,u,new li(t.name,n));return new or(h,t)}function Qd(t,e){let n=rr[e];(!n||n[t.key]!==t)&&ge(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Ll(t),delete n[t.key]}function Yd(t,e,n,s){let i=rr[e.name];i||(i={},rr[e.name]=i);let r=i[t.toURLString()];return r&&ge("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new zi(t,zd,n,s),i[t.toURLString()]=r,r}var or=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kd(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new J(this._repo,T())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Qd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&ge("Cannot call "+e+" on a deleted database.")}};function sc(){tl.IS_TRANSPORT_INITIALIZED&&q("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function ic(){sc(),Vt.forceDisallow()}function rc(){sc(),tt.forceDisallow(),Vt.forceAllow()}function oc(t,e,n,s={}){t=A(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&ge("Cannot call useEmulator() after instance has already been initialized.");let i=t._repoInternal,r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&ge('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new $t($t.OWNER);else if(s.mockUserToken){let o=typeof s.mockUserToken=="string"?s.mockUserToken:In(s.mockUserToken,t.app.options.projectId);r=new $t(o)}Kd(i,e,n,r)}function ac(t){t=A(t),t._checkNotDeleted("goOffline"),Ll(t._repo)}function lc(t){t=A(t),t._checkNotDeleted("goOnline"),Ud(t._repo)}function cc(t,e){Fa(t,e)}function Xd(t){cr(An),Pn(new de("database",(e,{instanceIdentifier:n})=>{let s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return qr(s,i,r,n)},"PUBLIC").setMultipleInstances(!0)),Ie(na,sa,t),Ie(na,sa,"esm2017")}var Jd={".sv":"timestamp"};function uc(){return Jd}function hc(t){return{".sv":{increment:t}}}var ar=class{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function dc(t,e,n){var s;if(t=A(t),Y("Reference.transaction",t._path),t.key===".length"||t.key===".keys")throw"Reference.transaction failed: "+t.key+" is a read-only object.";let i=(s=n?.applyLocally)!==null&&s!==void 0?s:!0,r=new H,o=(l,c,u)=>{let h=null;l?r.reject(l):(h=new ht(u,new J(t._repo,t._path),S),r.resolve(new ar(c,h)))},a=Ss(t,()=>{});return Bd(t._repo,t._path,e,o,a,i),r.promise}_r.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};_r.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Xd();var Zd="@firebase/database-compat",ef="1.0.4";var tf=new kn("@firebase/database-compat"),fc=function(t){let e="FIREBASE WARNING: "+t;tf.warn(e)};var nf=function(t,e,n,s){if(!(s&&n===void 0)&&typeof n!="boolean")throw new Error(Q(t,e)+"must be a boolean.")},sf=function(t,e,n){if(!(n&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Q(t,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var jr=class{constructor(e){this._delegate=e}cancel(e){g("OnDisconnect.cancel",0,1,arguments.length),U("OnDisconnect.cancel","onComplete",e,!0);let n=this._delegate.cancel();return e&&n.then(()=>e(null),s=>e(s)),n}remove(e){g("OnDisconnect.remove",0,1,arguments.length),U("OnDisconnect.remove","onComplete",e,!0);let n=this._delegate.remove();return e&&n.then(()=>e(null),s=>e(s)),n}set(e,n){g("OnDisconnect.set",1,2,arguments.length),U("OnDisconnect.set","onComplete",n,!0);let s=this._delegate.set(e);return n&&s.then(()=>n(null),i=>n(i)),s}setWithPriority(e,n,s){g("OnDisconnect.setWithPriority",2,3,arguments.length),U("OnDisconnect.setWithPriority","onComplete",s,!0);let i=this._delegate.setWithPriority(e,n);return s&&i.then(()=>s(null),r=>s(r)),i}update(e,n){if(g("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,fc("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}U("OnDisconnect.update","onComplete",n,!0);let s=this._delegate.update(e);return n&&s.then(()=>n(null),i=>n(i)),s}};var Hr=class{constructor(e,n){this.committed=e,this.snapshot=n}toJSON(){return g("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Ve=class t{constructor(e,n){this._database=e,this._delegate=n}val(){return g("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return g("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return g("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return g("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return g("DataSnapshot.child",0,1,arguments.length),e=String(e),pt("DataSnapshot.child","path",e,!1),new t(this._database,this._delegate.child(e))}hasChild(e){return g("DataSnapshot.hasChild",1,1,arguments.length),pt("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return g("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return g("DataSnapshot.forEach",1,1,arguments.length),U("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(n=>e(new t(this._database,n)))}hasChildren(){return g("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return g("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return g("DataSnapshot.ref",0,0,arguments.length),new Te(this._database,this._delegate.ref)}get ref(){return this.getRef()}},Ns=class t{constructor(e,n){this.database=e,this._delegate=n}on(e,n,s,i){var r;g("Query.on",2,4,arguments.length),U("Query.on","callback",n,!1);let o=t.getCancelAndContextArgs_("Query.on",s,i),a=(c,u)=>{n.call(o.context,new Ve(this.database,c),u)};a.userCallback=n,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return Ss(this._delegate,a,l),n;case"child_added":return Fr(this._delegate,a,l),n;case"child_removed":return Wr(this._delegate,a,l),n;case"child_changed":return Ur(this._delegate,a,l),n;case"child_moved":return Br(this._delegate,a,l),n;default:throw new Error(Q("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,n,s){if(g("Query.off",0,3,arguments.length),sf("Query.off",e,!0),U("Query.off","callback",n,!0),Gs("Query.off","context",s,!0),n){let i=()=>{};i.userCallback=n,i.context=s,$r(this._delegate,e,i)}else $r(this._delegate,e)}get(){return Vl(this._delegate).then(e=>new Ve(this.database,e))}once(e,n,s,i){g("Query.once",1,4,arguments.length),U("Query.once","callback",n,!0);let r=t.getCancelAndContextArgs_("Query.once",s,i),o=new H,a=(c,u)=>{let h=new Ve(this.database,c);n&&n.call(r.context,h,u),o.resolve(h)};a.userCallback=n,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Ss(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Fr(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Wr(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Ur(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Br(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(Q("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return g("Query.limitToFirst",1,1,arguments.length),new t(this.database,ie(this._delegate,Yl(e)))}limitToLast(e){return g("Query.limitToLast",1,1,arguments.length),new t(this.database,ie(this._delegate,Xl(e)))}orderByChild(e){return g("Query.orderByChild",1,1,arguments.length),new t(this.database,ie(this._delegate,Jl(e)))}orderByKey(){return g("Query.orderByKey",0,0,arguments.length),new t(this.database,ie(this._delegate,Zl()))}orderByPriority(){return g("Query.orderByPriority",0,0,arguments.length),new t(this.database,ie(this._delegate,ec()))}orderByValue(){return g("Query.orderByValue",0,0,arguments.length),new t(this.database,ie(this._delegate,tc()))}startAt(e=null,n){return g("Query.startAt",0,2,arguments.length),new t(this.database,ie(this._delegate,Kl(e,n)))}startAfter(e=null,n){return g("Query.startAfter",0,2,arguments.length),new t(this.database,ie(this._delegate,Ql(e,n)))}endAt(e=null,n){return g("Query.endAt",0,2,arguments.length),new t(this.database,ie(this._delegate,Gl(e,n)))}endBefore(e=null,n){return g("Query.endBefore",0,2,arguments.length),new t(this.database,ie(this._delegate,zl(e,n)))}equalTo(e,n){return g("Query.equalTo",1,2,arguments.length),new t(this.database,ie(this._delegate,nc(e,n)))}toString(){return g("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return g("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(g("Query.isEqual",1,1,arguments.length),!(e instanceof t)){let n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,n,s){let i={cancel:void 0,context:void 0};if(n&&s)i.cancel=n,U(e,"cancel",i.cancel,!0),i.context=s,Gs(e,"context",i.context,!0);else if(n)if(typeof n=="object"&&n!==null)i.context=n;else if(typeof n=="function")i.cancel=n;else throw new Error(Q(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new Te(this.database,new J(this._delegate._repo,this._delegate._path))}},Te=class t extends Ns{constructor(e,n){super(e,new z(n._repo,n._path,new Xt,!1)),this.database=e,this._delegate=n}getKey(){return g("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return g("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new t(this.database,Oe(this._delegate,e))}getParent(){g("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new t(this.database,e):null}getRoot(){return g("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)}set(e,n){g("Reference.set",1,2,arguments.length),U("Reference.set","onComplete",n,!0);let s=Rs(this._delegate,e);return n&&s.then(()=>n(null),i=>n(i)),s}update(e,n){if(g("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let r=0;r<e.length;++r)i[""+r]=e[r];e=i,fc("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Y("Reference.update",this._delegate._path),U("Reference.update","onComplete",n,!0);let s=Hl(this._delegate,e);return n&&s.then(()=>n(null),i=>n(i)),s}setWithPriority(e,n,s){g("Reference.setWithPriority",2,3,arguments.length),U("Reference.setWithPriority","onComplete",s,!0);let i=jl(this._delegate,e,n);return s&&i.then(()=>s(null),r=>s(r)),i}remove(e){g("Reference.remove",0,1,arguments.length),U("Reference.remove","onComplete",e,!0);let n=$l(this._delegate);return e&&n.then(()=>e(null),s=>e(s)),n}transaction(e,n,s){g("Reference.transaction",1,3,arguments.length),U("Reference.transaction","transactionUpdate",e,!1),U("Reference.transaction","onComplete",n,!0),nf("Reference.transaction","applyLocally",s,!0);let i=dc(this._delegate,e,{applyLocally:s}).then(r=>new Hr(r.committed,new Ve(this.database,r.snapshot)));return n&&i.then(r=>n(null,r.committed,r.snapshot),r=>n(r,!1,null)),i}setPriority(e,n){g("Reference.setPriority",1,2,arguments.length),U("Reference.setPriority","onComplete",n,!0);let s=ql(this._delegate,e);return n&&s.then(()=>n(null),i=>n(i)),s}push(e,n){g("Reference.push",0,2,arguments.length),U("Reference.push","onComplete",n,!0);let s=Wl(this._delegate,e),i=s.then(o=>new t(this.database,o));n&&i.then(()=>n(null),o=>n(o));let r=new t(this.database,s);return r.then=i.then.bind(i),r.catch=i.catch.bind(i,void 0),r}onDisconnect(){return Y("Reference.onDisconnect",this._delegate._path),new jr(new os(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var Ge=class{constructor(e,n){this._delegate=e,this.app=n,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:ic,forceLongPolling:rc}}useEmulator(e,n,s={}){oc(this._delegate,e,n,s)}ref(e){if(g("database.ref",0,1,arguments.length),e instanceof Te){let n=Lr(this._delegate,e.toString());return new Te(this,n)}else{let n=Mr(this._delegate,e);return new Te(this,n)}}refFromURL(e){g("database.refFromURL",1,1,arguments.length);let s=Lr(this._delegate,e);return new Te(this,s)}goOffline(){return g("database.goOffline",0,0,arguments.length),ac(this._delegate)}goOnline(){return g("database.goOnline",0,0,arguments.length),lc(this._delegate)}};Ge.ServerValue={TIMESTAMP:uc(),increment:t=>hc(t)};function rf({app:t,url:e,version:n,customAuthImpl:s,customAppCheckImpl:i,namespace:r,nodeAdmin:o=!1}){cr(n);let a=new zs("database-standalone"),l=new Nn("auth-internal",a);l.setComponent(new de("auth-internal",()=>s,"PRIVATE"));let c;return i&&(c=new Nn("app-check-internal",a),c.setComponent(new de("app-check-internal",()=>i,"PRIVATE"))),{instance:new Ge(qr(t,l,c,e,o),t),namespace:r}}var of=Object.freeze({__proto__:null,initStandalone:rf});var af=Ge.ServerValue;function lf(t){t.INTERNAL.registerComponent(new de("database-compat",(e,{instanceIdentifier:n})=>{let s=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:n});return new Ge(i,s)},"PUBLIC").setServiceProps({Reference:Te,Query:Ns,Database:Ge,DataSnapshot:Ve,enableLogging:cc,INTERNAL:of,ServerValue:af}).setMultipleInstances(!0)),t.registerVersion(Zd,ef)}lf(Re);function pn(t,e,n="on",s=co){return new Cn(i=>{let r=null;return r=t[n](e,(o,a)=>{s.schedule(()=>{i.next({snapshot:o,prevKey:a})}),n==="once"&&s.schedule(()=>i.complete())},o=>{s.schedule(()=>i.error(o))}),n==="on"?{unsubscribe(){r!=null&&t.off(e,r)}}:{unsubscribe(){}}}).pipe(Ce(i=>{let{snapshot:r,prevKey:o}=i,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),fo())}function hf(t){return typeof t=="string"}function df(t){return typeof t.exportVal=="function"}function yc(t){return t==null}function vc(t){return typeof t.set=="function"}function _c(t,e){return vc(e)?e:t.ref(e)}function wc(t,e){if(hf(t))return e.stringCase();if(vc(t))return e.firebaseCase();if(df(t))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof t}`)}function Cc(t){return(yc(t)||t.length===0)&&(t=["child_added","child_removed","child_changed","child_moved"]),t}function Ec(t,e,n){e=Cc(e);let s=e.map(i=>pn(t,i,"on",n));return $s(...s)}function ff(t,e,n){let s=Ec(t,e).pipe(qs((i,r)=>[...i,r],[]));return pf(t,s,n)}function _f(t,e){return pn(t,"value","on",e).pipe(Ce(n=>{let s;return n.payload.forEach(i=>(s=i.key,!1)),{data:n,lastKeyToLoad:s}}))}function pf(t,e,n){return _f(t,n).pipe(po(e),Ce(([i,r])=>{let o=i.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),_o(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Ce(i=>i.actions))}function pc(t,e){return function(s,i){return wc(s,{stringCase:()=>t.child(s)[e](i),firebaseCase:()=>s[e](i),snapshotCase:()=>s.ref[e](i)})}}function gf(t){return function(n){return n?wc(n,{stringCase:()=>t.child(n).remove(),firebaseCase:()=>n.remove(),snapshotCase:()=>n.ref.remove()}):t.remove()}}function mf(t,e,n){return pn(t,"value","once",n).pipe(Nt(s=>{let i=[St(s)];return e.forEach(r=>i.push(pn(t,r,"on",n))),$s(...i).pipe(qs(vf,[]))}),ho())}function Tc(t,e){let n=t.length;for(let s=0;s<n;s++)if(t[s].payload.key===e)return s;return-1}function yf(t,e){if(yc(e))return 0;{let n=Tc(t,e);return n===-1?t.length:n+1}}function vf(t,e){let{payload:n,prevKey:s,key:i}=e,r=Tc(t,i),o=yf(t,s);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,t=[...t,c],!1})}return t;case"child_added":if(r>-1)(t[r-1]?.key||null)!==s&&(t=t.filter(l=>l.payload.key!==n.key),t.splice(o,0,e));else{if(s==null)return[e,...t];t=t.slice(),t.splice(o,0,e)}return t;case"child_removed":return t.filter(a=>a.payload.key!==n.key);case"child_changed":return t.map(a=>a.payload.key===i?e:a);case"child_moved":if(r>-1){let a=t.splice(r,1)[0];return t=t.slice(),t.splice(o,0,a),t}return t;default:return t}}function gc(t,e,n){return e=Cc(e),mf(t,e,n)}function wf(t,e){let n=e.schedulers.outsideAngular,s=e.schedulers.ngZone.run(()=>t.ref);return{query:t,update:pc(s,"update"),set:pc(s,"set"),push:i=>s.push(i),remove:gf(s),snapshotChanges(i){return gc(t,i,n).pipe(fe)},stateChanges(i){return Ec(t,i,n).pipe(fe)},auditTrail(i){return ff(t,i,n).pipe(fe)},valueChanges(i,r){return gc(t,i,n).pipe(Ce(a=>a.map(l=>r&&r.idField?lo(ao({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),fe)}}}function mc(t,e){return function(){return pn(t,"value","on",e)}}function Cf(t,e){return{query:t,snapshotChanges(){return mc(t,e.schedulers.outsideAngular)().pipe(fe)},update(n){return t.ref.update(n)},set(n){return t.ref.set(n)},remove(){return t.ref.remove()},valueChanges(){return mc(t,e.schedulers.outsideAngular)().pipe(fe,Ce(s=>s.payload.exists()?s.payload.val():null))}}}var Ef=new ue("angularfire2.realtimeDatabaseURL"),Tf=new ue("angularfire2.database.use-emulator"),bf=(()=>{class t{schedulers;database;constructor(n,s,i,r,o,a,l,c,u,h,d,f,p,m,v){this.schedulers=a;let O=l,L=On(n,o,s);c&&zo(L,o,u,d,f,p,h,m),this.database=Mn(`${L.name}.database.${i}`,"AngularFireDatabase",L.name,()=>{let P=o.runOutsideAngular(()=>L.database(i||void 0));return O&&P.useEmulator(...O),P},[O])}list(n,s){let i=this.schedulers.ngZone.runOutsideAngular(()=>_c(this.database,n)),r=i;return s&&(r=s(i)),wf(r,this)}object(n){let s=this.schedulers.ngZone.runOutsideAngular(()=>_c(this.database,n));return Cf(s,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(s){return new(s||t)(I(xn),I(Dn,8),I(Ef,8),I(bn),I(kt),I(Mt),I(Tf,8),I(Ko,8),I($o,8),I(qo,8),I(jo,8),I(Ho,8),I(Vo,8),I(Go,8),I(Ot,8))};static \u0275prov=En({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})(),bc=(()=>{class t{constructor(){Re.registerVersion("angularfire",Je.full,"rtdb-compat")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=oe({type:t});static \u0275inj=re({providers:[bf]})}return t})();var Dc="firebasestorage.googleapis.com",Oc="storageBucket",If=2*60*1e3,Rf=10*60*1e3,Sf=1e3;var D=class t extends No{constructor(e,n,s=0){super(Vr(e),`Firebase Storage: ${n} (${Vr(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,t.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Vr(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}},k=function(t){return t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment",t}(k||{});function Vr(t){return"storage/"+t}function Zr(){let t="An unknown error occurred, please check the error payload for server response.";return new D(k.UNKNOWN,t)}function Nf(t){return new D(k.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function kf(t){return new D(k.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function Pf(){let t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new D(k.UNAUTHENTICATED,t)}function Af(){return new D(k.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function xf(t){return new D(k.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function Mc(){return new D(k.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Lc(){return new D(k.CANCELED,"User canceled the upload/download.")}function Df(t){return new D(k.INVALID_URL,"Invalid URL '"+t+"'.")}function Of(t){return new D(k.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Mf(){return new D(k.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Oc+"' property when initializing the app?")}function Fc(){return new D(k.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function Lf(){return new D(k.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function Ff(){return new D(k.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function Uf(t){return new D(k.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function ze(t){return new D(k.INVALID_ARGUMENT,t)}function Uc(){return new D(k.APP_DELETED,"The Firebase app was deleted.")}function eo(t){return new D(k.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function mn(t,e){return new D(k.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function gn(t){throw new D(k.INTERNAL_ERROR,"Internal error: "+t)}var K=class t{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let s;try{s=t.makeFromUrl(e,n)}catch{return new t(e,"")}if(s.path==="")return s;throw Of(e)}static makeFromUrl(e,n){let s=null,i="([A-Za-z0-9.\\-_]+)";function r(F){F.path.charAt(F.path.length-1)==="/"&&(F.path_=F.path_.slice(0,-1))}let o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),l={bucket:1,path:3};function c(F){F.path_=decodeURIComponent(F.path)}let u="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${i}/o${d}`,"i"),p={bucket:1,path:3},m=n===Dc?"(?:storage.googleapis.com|storage.cloud.google.com)":n,v="([^?#]*)",O=new RegExp(`^https?://${m}/${i}/${v}`,"i"),P=[{regex:a,indices:l,postModify:r},{regex:f,indices:p,postModify:c},{regex:O,indices:{bucket:1,path:2},postModify:c}];for(let F=0;F<P.length;F++){let Qe=P[F],Ye=Qe.regex.exec(e);if(Ye){let Bs=Ye[Qe.indices.bucket],It=Ye[Qe.indices.path];It||(It=""),s=new t(Bs,It),Qe.postModify(s);break}}if(s==null)throw Df(e);return s}},zr=class{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}};function Bf(t,e,n){let s=1,i=null,r=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...v){c||(c=!0,e.apply(null,v))}function h(v){i=setTimeout(()=>{i=null,t(f,l())},v)}function d(){r&&clearTimeout(r)}function f(v,...O){if(c){d();return}if(v){d(),u.call(null,v,...O);return}if(l()||o){d(),u.call(null,v,...O);return}s<64&&(s*=2);let P;a===1?(a=2,P=0):P=(s+Math.random())*1e3,h(P)}let p=!1;function m(v){p||(p=!0,d(),!c&&(i!==null?(v||(a=2),clearTimeout(i),h(0)):v||(a=1)))}return h(0),r=setTimeout(()=>{o=!0,m(!0)},n),m}function Wf(t){t(!1)}function $f(t){return t!==void 0}function qf(t){return typeof t=="function"}function jf(t){return typeof t=="object"&&!Array.isArray(t)}function As(t){return typeof t=="string"||t instanceof String}function Ic(t){return to()&&t instanceof Blob}function to(){return typeof Blob<"u"}function Kr(t,e,n,s){if(s<e)throw ze(`Invalid value for '${t}'. Expected ${e} or greater.`);if(s>n)throw ze(`Invalid value for '${t}'. Expected ${n} or less.`)}function Le(t,e,n){let s=e;return n==null&&(s=`https://${e}`),`${n}://${s}/v0${t}`}function Bc(t){let e=encodeURIComponent,n="?";for(let s in t)if(t.hasOwnProperty(s)){let i=e(s)+"="+e(t[s]);n=n+i+"&"}return n=n.slice(0,-1),n}var vt=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}(vt||{});function Wc(t,e){let n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,r=e.indexOf(t)!==-1;return n||i||r}var Qr=class{constructor(e,n,s,i,r,o,a,l,c,u,h,d=!0){this.url_=e,this.method_=n,this.headers_=s,this.body_=i,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,p)=>{this.resolve_=f,this.reject_=p,this.start_()})}start_(){let e=(s,i)=>{if(i){s(!1,new yt(!1,null,!0));return}let r=this.connectionFactory_();this.pendingConnection_=r;let o=a=>{let l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;let a=r.getErrorCode()===vt.NO_ERROR,l=r.getStatus();if(!a||Wc(l,this.additionalRetryCodes_)&&this.retry){let u=r.getErrorCode()===vt.ABORT;s(!1,new yt(!1,null,u));return}let c=this.successCodes_.indexOf(l)!==-1;s(!0,new yt(c,r))})},n=(s,i)=>{let r=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{let l=this.callback_(a,a.getResponse());$f(l)?r(l):r()}catch(l){o(l)}else if(a!==null){let l=Zr();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(i.canceled){let l=this.appDelete_?Uc():Lc();o(l)}else{let l=Mc();o(l)}};this.canceled_?n(!1,new yt(!1,null,!0)):this.backoffId_=Bf(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Wf(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}},yt=class{constructor(e,n,s){this.wasSuccessCode=e,this.connection=n,this.canceled=!!s}};function Hf(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Vf(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Gf(t,e){e&&(t["X-Firebase-GMPID"]=e)}function zf(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Kf(t,e,n,s,i,r,o=!0){let a=Bc(t.urlParams),l=t.url+a,c=Object.assign({},t.headers);return Gf(c,e),Hf(c,n),Vf(c,r),zf(c,s),new Qr(l,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}function Qf(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Yf(...t){let e=Qf();if(e!==void 0){let n=new e;for(let s=0;s<t.length;s++)n.append(t[s]);return n.getBlob()}else{if(to())return new Blob(t);throw new D(k.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Xf(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}function Jf(t){if(typeof atob>"u")throw Uf("base-64");return atob(t)}var ee={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},yn=class{constructor(e,n){this.data=e,this.contentType=n||null}};function no(t,e){switch(t){case ee.RAW:return new yn($c(e));case ee.BASE64:case ee.BASE64URL:return new yn(qc(t,e));case ee.DATA_URL:return new yn(e_(e),t_(e))}throw Zr()}function $c(t){let e=[];for(let n=0;n<t.length;n++){let s=t.charCodeAt(n);if(s<=127)e.push(s);else if(s<=2047)e.push(192|s>>6,128|s&63);else if((s&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{let r=s,o=t.charCodeAt(++n);s=65536|(r&1023)<<10|o&1023,e.push(240|s>>18,128|s>>12&63,128|s>>6&63,128|s&63)}else(s&64512)===56320?e.push(239,191,189):e.push(224|s>>12,128|s>>6&63,128|s&63)}return new Uint8Array(e)}function Zf(t){let e;try{e=decodeURIComponent(t)}catch{throw mn(ee.DATA_URL,"Malformed data URL.")}return $c(e)}function qc(t,e){switch(t){case ee.BASE64:{let i=e.indexOf("-")!==-1,r=e.indexOf("_")!==-1;if(i||r)throw mn(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case ee.BASE64URL:{let i=e.indexOf("+")!==-1,r=e.indexOf("/")!==-1;if(i||r)throw mn(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Jf(e)}catch(i){throw i.message.includes("polyfill")?i:mn(t,"Invalid character found")}let s=new Uint8Array(n.length);for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return s}var Ps=class{constructor(e){this.base64=!1,this.contentType=null;let n=e.match(/^data:([^,]+)?,/);if(n===null)throw mn(ee.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");let s=n[1]||null;s!=null&&(this.base64=n_(s,";base64"),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}};function e_(t){let e=new Ps(t);return e.base64?qc(ee.BASE64,e.rest):Zf(e.rest)}function t_(t){return new Ps(t).contentType}function n_(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}var wt=class t{constructor(e,n){let s=0,i="";Ic(e)?(this.data_=e,s=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(Ic(this.data_)){let s=this.data_,i=Xf(s,e,n);return i===null?null:new t(i)}else{let s=new Uint8Array(this.data_.buffer,e,n-e);return new t(s,!0)}}static getBlob(...e){if(to()){let n=e.map(s=>s instanceof t?s.data_:s);return new t(Yf.apply(null,n))}else{let n=e.map(o=>As(o)?no(ee.RAW,o).data:o.data_),s=0;n.forEach(o=>{s+=o.byteLength});let i=new Uint8Array(s),r=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[r++]=o[a]}),new t(i,!0)}}uploadData(){return this.data_}};function so(t){let e;try{e=JSON.parse(t)}catch{return null}return jf(e)?e:null}function s_(t){if(t.length===0)return null;let e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function i_(t,e){let n=e.split("/").filter(s=>s.length>0).join("/");return t.length===0?n:t+"/"+n}function jc(t){let e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}function r_(t,e){return e}var $=class{constructor(e,n,s,i){this.server=e,this.local=n||e,this.writable=!!s,this.xform=i||r_}},ks=null;function o_(t){return!As(t)||t.length<2?t:jc(t)}function xs(){if(ks)return ks;let t=[];t.push(new $("bucket")),t.push(new $("generation")),t.push(new $("metageneration")),t.push(new $("name","fullPath",!0));function e(r,o){return o_(o)}let n=new $("name");n.xform=e,t.push(n);function s(r,o){return o!==void 0?Number(o):o}let i=new $("size");return i.xform=s,t.push(i),t.push(new $("timeCreated")),t.push(new $("updated")),t.push(new $("md5Hash",null,!0)),t.push(new $("cacheControl",null,!0)),t.push(new $("contentDisposition",null,!0)),t.push(new $("contentEncoding",null,!0)),t.push(new $("contentLanguage",null,!0)),t.push(new $("contentType",null,!0)),t.push(new $("metadata","customMetadata",!0)),ks=t,ks}function a_(t,e){function n(){let s=t.bucket,i=t.fullPath,r=new K(s,i);return e._makeStorageReference(r)}Object.defineProperty(t,"ref",{get:n})}function l_(t,e,n){let s={};s.type="file";let i=n.length;for(let r=0;r<i;r++){let o=n[r];s[o.local]=o.xform(s,e[o.server])}return a_(s,t),s}function Hc(t,e,n){let s=so(e);return s===null?null:l_(t,s,n)}function c_(t,e,n,s){let i=so(e);if(i===null||!As(i.downloadTokens))return null;let r=i.downloadTokens;if(r.length===0)return null;let o=encodeURIComponent;return r.split(",").map(c=>{let u=t.bucket,h=t.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=Le(d,n,s),p=Bc({alt:"media",token:c});return f+p})[0]}function io(t,e){let n={},s=e.length;for(let i=0;i<s;i++){let r=e[i];r.writable&&(n[r.server]=t[r.local])}return JSON.stringify(n)}var Rc="prefixes",Sc="items";function u_(t,e,n){let s={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[Rc])for(let i of n[Rc]){let r=i.replace(/\/$/,""),o=t._makeStorageReference(new K(e,r));s.prefixes.push(o)}if(n[Sc])for(let i of n[Sc]){let r=t._makeStorageReference(new K(e,i.name));s.items.push(r)}return s}function h_(t,e,n){let s=so(n);return s===null?null:u_(t,e,s)}var ce=class{constructor(e,n,s,i){this.url=e,this.method=n,this.handler=s,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}};function we(t){if(!t)throw Zr()}function Ds(t,e){function n(s,i){let r=Hc(t,i,e);return we(r!==null),r}return n}function d_(t,e){function n(s,i){let r=h_(t,e,i);return we(r!==null),r}return n}function f_(t,e){function n(s,i){let r=Hc(t,i,e);return we(r!==null),c_(r,i,t.host,t._protocol)}return n}function Tt(t){function e(n,s){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Af():i=Pf():n.getStatus()===402?i=kf(t.bucket):n.getStatus()===403?i=xf(t.path):i=s,i.status=n.getStatus(),i.serverResponse=s.serverResponse,i}return e}function Os(t){let e=Tt(t);function n(s,i){let r=e(s,i);return s.getStatus()===404&&(r=Nf(t.path)),r.serverResponse=i.serverResponse,r}return n}function Vc(t,e,n){let s=e.fullServerUrl(),i=Le(s,t.host,t._protocol),r="GET",o=t.maxOperationRetryTime,a=new ce(i,r,Ds(t,n),o);return a.errorHandler=Os(e),a}function __(t,e,n,s,i){let r={};e.isRoot?r.prefix="":r.prefix=e.path+"/",n&&n.length>0&&(r.delimiter=n),s&&(r.pageToken=s),i&&(r.maxResults=i);let o=e.bucketOnlyServerUrl(),a=Le(o,t.host,t._protocol),l="GET",c=t.maxOperationRetryTime,u=new ce(a,l,d_(t,e.bucket),c);return u.urlParams=r,u.errorHandler=Tt(e),u}function p_(t,e,n){let s=e.fullServerUrl(),i=Le(s,t.host,t._protocol),r="GET",o=t.maxOperationRetryTime,a=new ce(i,r,f_(t,n),o);return a.errorHandler=Os(e),a}function g_(t,e,n,s){let i=e.fullServerUrl(),r=Le(i,t.host,t._protocol),o="PATCH",a=io(n,s),l={"Content-Type":"application/json; charset=utf-8"},c=t.maxOperationRetryTime,u=new ce(r,o,Ds(t,s),c);return u.headers=l,u.body=a,u.errorHandler=Os(e),u}function m_(t,e){let n=e.fullServerUrl(),s=Le(n,t.host,t._protocol),i="DELETE",r=t.maxOperationRetryTime;function o(l,c){}let a=new ce(s,i,o,r);return a.successCodes=[200,204],a.errorHandler=Os(e),a}function y_(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function Gc(t,e,n){let s=Object.assign({},n);return s.fullPath=t.path,s.size=e.size(),s.contentType||(s.contentType=y_(null,e)),s}function v_(t,e,n,s,i){let r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let P="";for(let F=0;F<2;F++)P=P+Math.random().toString().slice(2);return P}let l=a();o["Content-Type"]="multipart/related; boundary="+l;let c=Gc(e,s,i),u=io(c,n),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+l+"--",f=wt.getBlob(h,s,d);if(f===null)throw Fc();let p={name:c.fullPath},m=Le(r,t.host,t._protocol),v="POST",O=t.maxUploadRetryTime,L=new ce(m,v,Ds(t,n),O);return L.urlParams=p,L.headers=o,L.body=f.uploadData(),L.errorHandler=Tt(e),L}var Ct=class{constructor(e,n,s,i){this.current=e,this.total=n,this.finalized=!!s,this.metadata=i||null}};function ro(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{we(!1)}return we(!!n&&(e||["active"]).indexOf(n)!==-1),n}function w_(t,e,n,s,i){let r=e.bucketOnlyServerUrl(),o=Gc(e,s,i),a={name:o.fullPath},l=Le(r,t.host,t._protocol),c="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${s.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=io(o,n),d=t.maxUploadRetryTime;function f(m){ro(m);let v;try{v=m.getResponseHeader("X-Goog-Upload-URL")}catch{we(!1)}return we(As(v)),v}let p=new ce(l,c,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Tt(e),p}function C_(t,e,n,s){let i={"X-Goog-Upload-Command":"query"};function r(c){let u=ro(c,["active","final"]),h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{we(!1)}h||we(!1);let d=Number(h);return we(!isNaN(d)),new Ct(d,s.size(),u==="final")}let o="POST",a=t.maxUploadRetryTime,l=new ce(n,o,r,a);return l.headers=i,l.errorHandler=Tt(e),l}var Nc=256*1024;function E_(t,e,n,s,i,r,o,a){let l=new Ct(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=s.size()),s.size()!==l.total)throw Lf();let c=l.total-l.current,u=c;i>0&&(u=Math.min(u,i));let h=l.current,d=h+u,f="";u===0?f="finalize":c===u?f="upload, finalize":f="upload";let p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${l.current}`},m=s.slice(h,d);if(m===null)throw Fc();function v(F,Qe){let Ye=ro(F,["active","final"]),Bs=l.current+u,It=s.size(),Ws;return Ye==="final"?Ws=Ds(e,r)(F,Qe):Ws=null,new Ct(Bs,It,Ye==="final",Ws)}let O="POST",L=e.maxUploadRetryTime,P=new ce(n,O,v,L);return P.headers=p,P.body=m.uploadData(),P.progressCallback=a||null,P.errorHandler=Tt(t),P}var zc={STATE_CHANGED:"state_changed"},j={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Gr(t){switch(t){case"running":case"pausing":case"canceling":return j.RUNNING;case"paused":return j.PAUSED;case"success":return j.SUCCESS;case"canceled":return j.CANCELED;case"error":return j.ERROR;default:return j.ERROR}}var Yr=class{constructor(e,n,s){if(qf(e)||n!=null||s!=null)this.next=e,this.error=n??void 0,this.complete=s??void 0;else{let r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}};function mt(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}var kc=null,Xr=class{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=vt.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=vt.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=vt.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,s,i){if(this.sent_)throw gn("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(let r in i)i.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,i[r].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw gn("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw gn("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw gn("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw gn("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}},Jr=class extends Xr{initXhr(){this.xhr_.responseType="text"}};function ve(){return kc?kc():new Jr}var vn=class{constructor(e,n,s=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=s,this._mappings=xs(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(k.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{let r=this.isExponentialBackoffExpired();if(Wc(i.status,[]))if(r)i=Mc();else{this.sleepTime=Math.max(this.sleepTime*2,Sf),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(k.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,r)=>{this._resolve=i,this._reject=r,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){let e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,s])=>{switch(this._state){case"running":e(n,s);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{let s=w_(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(s,ve,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._uploadUrl=r,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){let e=this._uploadUrl;this._resolveToken((n,s)=>{let i=C_(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(i,ve,n,s);this._request=r,r.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){let e=Nc*this._chunkMultiplier,n=new Ct(this._transferred,this._blob.size()),s=this._uploadUrl;this._resolveToken((i,r)=>{let o;try{o=E_(this._ref._location,this._ref.storage,s,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}let a=this._ref.storage._makeRequest(o,ve,i,r,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Nc*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{let s=Vc(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(s,ve,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{let s=v_(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(s,ve,e,n);this._request=i,i.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){let n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":let n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Lc(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){let e=Gr(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,s,i){let r=new Yr(n||void 0,s||void 0,i||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){let n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(Gr(this._state)){case j.SUCCESS:mt(this._resolve.bind(null,this.snapshot))();break;case j.CANCELED:case j.ERROR:let n=this._reject;mt(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Gr(this._state)){case j.RUNNING:case j.PAUSED:e.next&&mt(e.next.bind(e,this.snapshot))();break;case j.SUCCESS:e.complete&&mt(e.complete.bind(e))();break;case j.CANCELED:case j.ERROR:e.error&&mt(e.error.bind(e,this._error))();break;default:e.error&&mt(e.error.bind(e,this._error))()}}resume(){let e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){let e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){let e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}};var Et=class t{constructor(e,n){this._service=e,n instanceof K?this._location=n:this._location=K.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new t(e,n)}get root(){let e=new K(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return jc(this._location.path)}get storage(){return this._service}get parent(){let e=s_(this._location.path);if(e===null)return null;let n=new K(this._location.bucket,e);return new t(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw eo(e)}};function T_(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new vn(t,new wt(e),n)}function b_(t){let e={prefixes:[],items:[]};return Kc(t,e).then(()=>e)}function Kc(t,e,n){return Fe(this,null,function*(){let i=yield Qc(t,{pageToken:n});e.prefixes.push(...i.prefixes),e.items.push(...i.items),i.nextPageToken!=null&&(yield Kc(t,e,i.nextPageToken))})}function Qc(t,e){e!=null&&typeof e.maxResults=="number"&&Kr("options.maxResults",1,1e3,e.maxResults);let n=e||{},s=__(t.storage,t._location,"/",n.pageToken,n.maxResults);return t.storage.makeRequestWithTokens(s,ve)}function I_(t){t._throwIfRoot("getMetadata");let e=Vc(t.storage,t._location,xs());return t.storage.makeRequestWithTokens(e,ve)}function R_(t,e){t._throwIfRoot("updateMetadata");let n=g_(t.storage,t._location,e,xs());return t.storage.makeRequestWithTokens(n,ve)}function S_(t){t._throwIfRoot("getDownloadURL");let e=p_(t.storage,t._location,xs());return t.storage.makeRequestWithTokens(e,ve).then(n=>{if(n===null)throw Ff();return n})}function N_(t){t._throwIfRoot("deleteObject");let e=m_(t.storage,t._location);return t.storage.makeRequestWithTokens(e,ve)}function Yc(t,e){let n=i_(t._location.path,e),s=new K(t._location.bucket,n);return new Et(t.storage,s)}function k_(t){return/^[A-Za-z]+:\/\//.test(t)}function P_(t,e){return new Et(t,e)}function Xc(t,e){if(t instanceof wn){let n=t;if(n._bucket==null)throw Mf();let s=new Et(n,n._bucket);return e!=null?Xc(s,e):s}else return e!==void 0?Yc(t,e):t}function A_(t,e){if(e&&k_(e)){if(t instanceof wn)return P_(t,e);throw ze("To use ref(service, url), the first argument must be a Storage instance.")}else return Xc(t,e)}function Pc(t,e){let n=e?.[Oc];return n==null?null:K.makeFromBucketSpec(n,t)}function x_(t,e,n,s={}){t.host=`${e}:${n}`,t._protocol="http";let{mockUserToken:i}=s;i&&(t._overrideAuthToken=typeof i=="string"?i:In(i,t.app.options.projectId))}var wn=class{constructor(e,n,s,i,r){this.app=e,this._authProvider=n,this._appCheckProvider=s,this._url=i,this._firebaseVersion=r,this._bucket=null,this._host=Dc,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=If,this._maxUploadRetryTime=Rf,this._requests=new Set,i!=null?this._bucket=K.makeFromBucketSpec(i,this._host):this._bucket=Pc(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=K.makeFromBucketSpec(this._url,e):this._bucket=Pc(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Kr("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Kr("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return Fe(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let n=yield e.getToken();if(n!==null)return n.accessToken}return null})}_getAppCheckToken(){return Fe(this,null,function*(){let e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Et(this,e)}_makeRequest(e,n,s,i,r=!0){if(this._deleted)return new zr(Uc());{let o=Kf(e,this._appId,s,i,n,this._firebaseVersion,r);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,n){return Fe(this,null,function*(){let[s,i]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,s,i).getPromise()})}},Ac="@firebase/storage",xc="0.12.4";var D_="storage";function Jc(t,e,n){return t=A(t),T_(t,e,n)}function Zc(t){return t=A(t),I_(t)}function eu(t,e){return t=A(t),R_(t,e)}function tu(t,e){return t=A(t),Qc(t,e)}function nu(t){return t=A(t),b_(t)}function su(t){return t=A(t),S_(t)}function iu(t){return t=A(t),N_(t)}function oo(t,e){return t=A(t),A_(t,e)}function ru(t,e){return Yc(t,e)}function ou(t,e,n,s={}){x_(t,e,n,s)}function O_(t,{instanceIdentifier:e}){let n=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new wn(n,s,i,e,An)}function M_(){Pn(new de(D_,O_,"PUBLIC").setMultipleInstances(!0)),Ie(Ac,xc,""),Ie(Ac,xc,"esm2017")}M_();var bt=class{constructor(e,n,s){this._delegate=e,this.task=n,this.ref=s}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}};var Ms=class{constructor(e,n){this._delegate=e,this._ref=n,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new bt(this._delegate.snapshot,this,this._ref)}then(e,n){return this._delegate.then(s=>{if(e)return e(new bt(s,this,this._ref))},n)}on(e,n,s,i){let r;return n&&(typeof n=="function"?r=o=>n(new bt(o,this,this._ref)):r={next:n.next?o=>n.next(new bt(o,this,this._ref)):void 0,complete:n.complete||void 0,error:n.error||void 0}),this._delegate.on(e,r,s||void 0,i||void 0)}},Ls=class{constructor(e,n){this._delegate=e,this._service=n}get prefixes(){return this._delegate.prefixes.map(e=>new Ke(e,this._service))}get items(){return this._delegate.items.map(e=>new Ke(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}};var Ke=class t{constructor(e,n){this._delegate=e,this.storage=n}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){let n=ru(this._delegate,e);return new t(n,this.storage)}get root(){return new t(this._delegate.root,this.storage)}get parent(){let e=this._delegate.parent;return e==null?null:new t(e,this.storage)}put(e,n){return this._throwIfRoot("put"),new Ms(Jc(this._delegate,e,n),this)}putString(e,n=ee.RAW,s){this._throwIfRoot("putString");let i=no(n,e),r=Object.assign({},s);return r.contentType==null&&i.contentType!=null&&(r.contentType=i.contentType),new Ms(new vn(this._delegate,new wt(i.data,!0),r),this)}listAll(){return nu(this._delegate).then(e=>new Ls(e,this.storage))}list(e){return tu(this._delegate,e||void 0).then(n=>new Ls(n,this.storage))}getMetadata(){return Zc(this._delegate)}updateMetadata(e){return eu(this._delegate,e)}getDownloadURL(){return su(this._delegate)}delete(){return this._throwIfRoot("delete"),iu(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw eo(e)}};var Fs=class{constructor(e,n){this.app=e,this._delegate=n}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(au(e))throw ze("ref() expected a child path but got a URL, use refFromURL instead.");return new Ke(oo(this._delegate,e),this)}refFromURL(e){if(!au(e))throw ze("refFromURL() expected a full URL but got a child path, use ref() instead.");try{K.makeFromUrl(e,this._delegate.host)}catch{throw ze("refFromUrl() expected a valid full URL but got an invalid one.")}return new Ke(oo(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,n,s={}){ou(this._delegate,e,n,s)}};function au(t){return/^[A-Za-z]+:\/\//.test(t)}var L_="@firebase/storage-compat",F_="0.3.7";var U_="storage-compat";function B_(t,{instanceIdentifier:e}){let n=t.getProvider("app-compat").getImmediate(),s=t.getProvider("storage").getImmediate({identifier:e});return new Fs(n,s)}function W_(t){let e={TaskState:j,TaskEvent:zc,StringFormat:ee,Storage:Fs,Reference:Ke};t.INTERNAL.registerComponent(new de(U_,B_,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),t.registerVersion(L_,F_)}W_(Re);function $_(t){return new Cn(e=>{let n=o=>e.next(o),s=o=>e.error(o),i=()=>e.complete();n(t.snapshot);let r=t.on("state_changed",n);return t.then(o=>{n(o),i()},o=>{n(t.snapshot),s(o)}),function(){r()}}).pipe(uo(0))}function lu(t){let e=$_(t);return{task:t,then:t.then.bind(t),catch:t.catch.bind(t),pause:t.pause.bind(t),cancel:t.cancel.bind(t),resume:t.resume.bind(t),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(Ce(n=>n.bytesTransferred/n.totalBytes*100))}}function Us(t){return{getDownloadURL:()=>St(void 0).pipe(Ks,Nt(()=>t.getDownloadURL()),fe),getMetadata:()=>St(void 0).pipe(Ks,Nt(()=>t.getMetadata()),fe),delete:()=>Rt(t.delete()),child:e=>Us(t.child(e)),updateMetadata:e=>Rt(t.updateMetadata(e)),put:(e,n)=>{let s=t.put(e,n);return lu(s)},putString:(e,n,s)=>{let i=t.putString(e,n,s);return lu(i)},list:e=>Rt(t.list(e)),listAll:()=>Rt(t.listAll())}}var q_=new ue("angularfire2.storageBucket"),j_=new ue("angularfire2.storage.maxUploadRetryTime"),H_=new ue("angularfire2.storage.maxOperationRetryTime"),V_=new ue("angularfire2.storage.use-emulator"),G_=(()=>{class t{storage;constructor(n,s,i,r,o,a,l,c,u,h){let d=On(n,o,s);this.storage=Mn(`${d.name}.storage.${i}`,"AngularFireStorage",d.name,()=>{let f=o.runOutsideAngular(()=>d.storage(i||void 0)),p=u;return p&&f.useEmulator(...p),l&&f.setMaxUploadRetryTime(l),c&&f.setMaxOperationRetryTime(c),f},[l,c])}ref(n){return Us(this.storage.ref(n))}refFromURL(n){return Us(this.storage.refFromURL(n))}upload(n,s,i){let r=this.storage.ref(n);return Us(r).put(s,i)}static \u0275fac=function(s){return new(s||t)(I(xn),I(Dn,8),I(q_,8),I(bn),I(kt),I(Mt),I(j_,8),I(H_,8),I(V_,8),I(Ot,8))};static \u0275prov=En({token:t,factory:t.\u0275fac,providedIn:"any"})}return t})();var z_=(()=>{class t{static \u0275fac=function(s){return new(s||t)};static \u0275mod=oe({type:t});static \u0275inj=re({})}return t})(),cu=(()=>{class t{constructor(){Re.registerVersion("angularfire",Je.full,"gcs-compat")}static \u0275fac=function(s){return new(s||t)};static \u0275mod=oe({type:t});static \u0275inj=re({providers:[G_],imports:[z_]})}return t})();var uu={production:!1,firebaseConfig:{apiKey:"AIzaSyBpz1QDUAly7LP1nqzlBRmjXsBOMijCbJM",authDomain:"mercarfrut.firebaseapp.com",databaseURL:"https://mercarfrut-default-rtdb.firebaseio.com",projectId:"mercarfrut",storageBucket:"mercarfrut.appspot.com",messagingSenderId:"186209699604",appId:"1:186209699604:web:ad258109b880dc9f71a401"}};var hu=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=oe({type:e,bootstrap:[ta]}),e.\u0275inj=re({imports:[To,ea,Jo,Wo.initializeApp(uu.firebaseConfig),bc,Qo,cu]});let t=e;return t})();Eo().bootstrapModule(hu).catch(t=>console.error(t));
